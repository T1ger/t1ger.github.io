<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>t1ger的茶馆</title>
  <subtitle>头顶有光终是幻，足下生云未是仙</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://t1ger.github.io/"/>
  <updated>2018-12-27T08:24:50.264Z</updated>
  <id>https://t1ger.github.io/</id>
  
  <author>
    <name>t1ger</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>how to use hexo deploy blog by  private gitlab</title>
    <link href="https://t1ger.github.io/2018/12/27/how-to-use-hexo-deploy-blog-by-private-gitlab/"/>
    <id>https://t1ger.github.io/2018/12/27/how-to-use-hexo-deploy-blog-by-private-gitlab/</id>
    <published>2018-12-27T07:52:17.000Z</published>
    <updated>2018-12-27T08:24:50.264Z</updated>
    
    <content type="html"><![CDATA[<p>环境：<br>gitlab访问地址： gitlab.io.com.cn<br>博客访问地址: tiger.pages.io.com.cn</p>
<p>1.开启GitLab Pages功能<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">##! Define to enable GitLab Pages</span><br><span class="line">pages_external_url &quot;pages.io.com.cn&quot;</span><br><span class="line">gitlab_pages[&apos;enable&apos;] = true</span><br></pre></td></tr></table></figure></p>
<p>2.安装配置GitLab Runner,可以点击<a href="https://packages.gitlab.com/runner/gitlab-runner" target="_blank" rel="noopener">这里</a> ，进行安装<br>通过 gitlab-runner register 命令进行注册，按照提示完成</p>
<p>3.配置nginx，这里nginx没有使用gitlab内置nginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen         80;</span><br><span class="line">        server_name   *.pages.io.com.cn;</span><br><span class="line">        error_log  logs/pages_error.log;</span><br><span class="line">        access_log logs/pages_access.log main;</span><br><span class="line"></span><br><span class="line">        charset utf-8;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">        error_page  404              /404.html;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line"></span><br><span class="line">        root  /usr/local/gitlab/$http_host/public;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>4.提交blog代码</p>
<ul>
<li>登录gitlab.io.com.cn,在gitlab新建项目blog，这里为tiger.pages.io.com.cn<br>注意：项目名必须为访问域名，否则无法访问</li>
<li><p>本地新建hexo项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cd test  #存放项目的目录</span><br><span class="line">$ hexo init blog  #下载模版项目</span><br><span class="line">$ cd blog  #打开模板项目目录</span><br><span class="line">$ cnpm install  #下载相关依赖的包</span><br><span class="line">$ cnpm install hexo-deployer-git --save  #安装扩展包</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果一切正常的话，就可以发布到gitlab pages上</p>
</li>
<li><p>添加ssh-key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;tiger&quot;</span><br><span class="line">git config --global user.email &quot;tiger@gitlab.io.com.cn&quot;</span><br><span class="line">ssh-keygen -t rsa -C &quot;work@tiger.pub&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加.gitlab-ci.yml 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">variables:</span><br><span class="line">  WebPath: &quot;/usr/local/gitlab&quot;</span><br><span class="line"></span><br><span class="line">stages:</span><br><span class="line">  - install</span><br><span class="line">  - build</span><br><span class="line">  - deploy</span><br><span class="line"></span><br><span class="line">cache:</span><br><span class="line">  paths:</span><br><span class="line">    - node_modules/</span><br><span class="line">    </span><br><span class="line">install_npm:</span><br><span class="line">  stage: install</span><br><span class="line">  script:</span><br><span class="line">    - npm install</span><br><span class="line">  only:</span><br><span class="line">    - master</span><br><span class="line"></span><br><span class="line">build_public:</span><br><span class="line">  stage: build</span><br><span class="line">  script:</span><br><span class="line">    - hexo g</span><br><span class="line">  only: </span><br><span class="line">    - master</span><br><span class="line"></span><br><span class="line">deploy:</span><br><span class="line">  stage: deploy</span><br><span class="line">  script:</span><br><span class="line">    - hexo d</span><br><span class="line">    - rsync -avz --delete public $WebPath/$CI_PROJECT_NAME</span><br><span class="line">  artifacts:</span><br><span class="line">    paths:</span><br><span class="line">    - public  </span><br><span class="line">  only:</span><br><span class="line">    - master</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改站点配置文件&amp;更换主题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin git@gitlab.io.com.cn/tiger/tiger.pages.io.com.cn.git</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;init blog&quot;</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>完成之后可以通过<a href="http://tiger.pages.io.com.cn" target="_blank" rel="noopener">http://tiger.pages.io.com.cn</a> 来浏览页面了</p>
<p>ref<br><a href="https://gitlab.com/gitlab-org/gitlab-ce/issues/33240" target="_blank" rel="noopener">Use gitlab pages under the same domain as gitlab</a><br><a href="https://wangxiaokai.vip/posts/2018-05-24-gitlab-ci-publish-hexo/" target="_blank" rel="noopener">个人站点升级持续集成，自动构建和部署</a><br><a href="http://www.daxiblog.com/2018/05/17/%E6%9C%AC%E5%9C%B0%E6%90%AD%E5%BB%BA%E7%9A%84gitlab%E4%B8%AD%E5%BC%80%E5%90%AFpages%E5%8A%9F%E8%83%BD%EF%BC%8C%E4%B8%8D%E9%9C%80%E8%A6%81%E5%9F%9F%E5%90%8D%E4%B9%9F%E5%8F%AF%E4%BB%A5/" target="_blank" rel="noopener">本地搭建的GitLab中开启Pages功能，不需要域名也可以</a></p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;环境：&lt;br&gt;gitlab访问地址： gitlab.io.com.cn&lt;br&gt;博客访问地址: tiger.pages.io.com.cn&lt;/p&gt;
&lt;p&gt;1.开启GitLab Pages功能&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>CentOS6 install Supervisor3</title>
    <link href="https://t1ger.github.io/2018/12/12/CentOS6-install-Supervisor3/"/>
    <id>https://t1ger.github.io/2018/12/12/CentOS6-install-Supervisor3/</id>
    <published>2018-12-12T10:06:52.000Z</published>
    <updated>2018-12-12T10:28:32.318Z</updated>
    
    <content type="html"><![CDATA[<ol>
<li><p>install python-pip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if exit epel, already install, first remove supervisor</span><br><span class="line">yum remove supervisor</span><br><span class="line"></span><br><span class="line">yum -y install python-pip</span><br></pre></td></tr></table></figure>
</li>
<li><p>install supervisor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pip install supervisor</span><br><span class="line"></span><br><span class="line"># supervisord -v</span><br><span class="line">3.3.4</span><br><span class="line"></span><br><span class="line">pip install meld3==1.0.0</span><br></pre></td></tr></table></figure>
</li>
<li><p>config supervisor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">echo_supervisord_conf &gt; /etc/supervisord.conf</span><br><span class="line"></span><br><span class="line">mkdir /etc/supervisor/conf.d</span><br><span class="line"></span><br><span class="line">/etc/supervisord.conf append below:</span><br><span class="line">[include]</span><br><span class="line">files = /etc/supervisor/conf.d/*.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>Supervisor manage program, /etc/supervisor/conf.d/xxxx.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[program:appname]</span><br><span class="line">command=/usr/local/redis/bin/redis-server /etc/redis.conf </span><br><span class="line">autostart=true</span><br><span class="line">autorestart=true</span><br><span class="line">user=redis</span><br><span class="line">redirect_stderr=true</span><br></pre></td></tr></table></figure>
</li>
<li><p>add system service</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/rc.d/init.d/supervisord https://raw.githubusercontent.com/Supervisor/initscripts/master/redhat-init-equeffelec</span><br><span class="line">chmod 755 /etc/rc.d/init.d/supervisord</span><br><span class="line">chkconfig --add supervisord</span><br><span class="line">service supervisord start</span><br><span class="line">pkill supervisord</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>ref<br><a href="https://raw.githubusercontent.com/Supervisor/initscripts/master/redhat-init-equeffelec" target="_blank" rel="noopener">redhat-init-equeffelec</a></p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;ol&gt;
&lt;li&gt;&lt;p&gt;install python-pip&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span c
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Getting Started with osquery</title>
    <link href="https://t1ger.github.io/2018/12/11/Getting-Started-with-osquery/"/>
    <id>https://t1ger.github.io/2018/12/11/Getting-Started-with-osquery/</id>
    <published>2018-12-11T09:04:39.000Z</published>
    <updated>2018-12-11T09:38:20.091Z</updated>
    
    <content type="html"><![CDATA[<ol>
<li><p>How to install</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#for Centos7</span><br><span class="line">sudo rpm -ivh https://osquery-packages.s3.amazonaws.com/centos7/noarch/osquery-s3-centos7-repo-1-0.0.noarch.rpm</span><br><span class="line">sudo yum install osquery</span><br><span class="line"></span><br><span class="line">sudo cp /usr/share/osquery/osquery.example.conf /etc/osquery/osquery.conf</span><br><span class="line"># sudo service osqueryd start</span><br><span class="line">sudo systemctl start osqueryd</span><br><span class="line"># for CentOS6.x</span><br><span class="line">sudo rpm -ivh https://osquery-packages.s3.amazonaws.com/centos6/noarch/osquery-s3-centos6-repo-1-0.0.noarch.rpm</span><br><span class="line">sudo yum install osquery</span><br><span class="line"></span><br><span class="line"># default packages create the following structure</span><br><span class="line">/etc/osquery/</span><br><span class="line">/usr/share/osquery/osquery.example.conf</span><br><span class="line">/usr/share/osquery/lenses/&#123;*&#125;.aug</span><br><span class="line">/usr/share/osquery/packs/&#123;*&#125;.conf</span><br><span class="line">/var/log/osquery/</span><br><span class="line">/usr/lib/osquery/</span><br><span class="line">/usr/bin/osqueryctl</span><br><span class="line">/usr/bin/osqueryd</span><br><span class="line">/usr/bin/osqueryi</span><br></pre></td></tr></table></figure>
</li>
<li><p>How to use</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">osquery&gt; SELECT pid, name, path FROM processes LIMIT 1;</span><br><span class="line">+-----+------+------------+</span><br><span class="line">| pid | name | path       |</span><br><span class="line">+-----+------+------------+</span><br><span class="line">| 1   | init | /sbin/init |</span><br><span class="line">+-----+------+------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">osqueryi --json &quot;SELECT * FROM processes limit 1&quot;</span><br><span class="line">[</span><br><span class="line">  &#123;&quot;cmdline&quot;:&quot;/sbin/init&quot;,&quot;cwd&quot;:&quot;/&quot;,&quot;disk_bytes_read&quot;:&quot;150400097280&quot;,&quot;disk_bytes_written&quot;:&quot;31441313792&quot;,&quot;egid&quot;:&quot;0&quot;,&quot;euid&quot;:&quot;0&quot;,&quot;gid&quot;:&quot;0&quot;,&quot;name&quot;:&quot;init&quot;,&quot;nice&quot;:&quot;0&quot;,&quot;on_disk&quot;:&quot;1&quot;,&quot;parent&quot;:&quot;0&quot;,&quot;path&quot;:&quot;/sbin/init&quot;,&quot;pgroup&quot;:&quot;1&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;resident_size&quot;:&quot;396000&quot;,&quot;root&quot;:&quot;/&quot;,&quot;sgid&quot;:&quot;0&quot;,&quot;start_time&quot;:&quot;0&quot;,&quot;state&quot;:&quot;S&quot;,&quot;suid&quot;:&quot;0&quot;,&quot;system_time&quot;:&quot;1440&quot;,&quot;threads&quot;:&quot;1&quot;,&quot;total_size&quot;:&quot;19356000&quot;,&quot;uid&quot;:&quot;0&quot;,&quot;user_time&quot;:&quot;230&quot;,&quot;wired_size&quot;:&quot;0&quot;&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Features Overview</p>
</li>
</ol>
<ul>
<li><p>osqueryd<br>The high-performance and low-footprint distributed host monitoring daemon,osqueryd, allows you to schedule queries to be executed across your entire infrastructure. The daemon takes care of aggregating the query results over time and generates logs which indicate state changes in your infrastructure. You can use this to maintain insight into the security, performance, configuration, and state of your entire infrastructure. osqueryd’s logging can integrate into your internal log aggregation pipeline, regardless of your technology stack, via a robust plugin architecture.</p>
</li>
<li><p>osqueryi<br>The interactive query console, gives you a SQL interface to try out new queries and explore your operating system.With the power of a complete SQL language and dozens of useful tables built-in,osqueryi is an invaluable tool when performing incident response, diagnosing an systems operations problem, troubleshooting a performance issue, etc.</p>
</li>
<li><p>osquery<br>osquery is cross platform. Even though osquery takes advantage of very low-level operating system APIs, you can build and use osquery on Mac OS X, Ubuntu, Cent OS and other popular enterprise Linux distributions</p>
</li>
<li><p>plugin architecture<br>To assist with the rollout process, the osquery user guide has detailed documentation on internal deployment. osquery was built so that every environment specific aspect of the toolchain can be hot-swapped at run-time with custom plugins. Use these interfaces to deeply integrate osquery into your infrastructure if one of the several existing plugins don not suit your needs</p>
</li>
</ul>
<ol start="4">
<li>Logging<br>The osquery daemon uses a default filesystem logging plugin. Like the config, output from the filesystem plugin is written as JSON.Results from the query schedule are written to /var/log/osquery/osqueryd.results.log.<br>There are two types of logs<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. Status logs (info, warning, error, and fatal)</span><br><span class="line">2. Query schedule results logs</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>ref<br><a href="https://github.com/facebook/osquery" target="_blank" rel="noopener">osquery</a><br><a href="https://blog.spoock.com/2018/11/27/usage-of-osqueryd/" target="_blank" rel="noopener">使用osqueryd监控系统</a></p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;ol&gt;
&lt;li&gt;&lt;p&gt;How to install&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>How to install ModSecurity with Nginx</title>
    <link href="https://t1ger.github.io/2018/11/22/How-to-install-ModSecurity-with-Nginx/"/>
    <id>https://t1ger.github.io/2018/11/22/How-to-install-ModSecurity-with-Nginx/</id>
    <published>2018-11-22T08:45:00.000Z</published>
    <updated>2018-11-22T09:44:29.757Z</updated>
    
    <content type="html"><![CDATA[<p>本文不打算写安装过程，具体安装参考<a href="https://github.com/SpiderLabs/ModSecurity/wiki/Compilation-recipes-for-v3.x" target="_blank" rel="noopener">这里</a><br>安装环境： centos6.8 </p>
<p>安装前准备,需要安装gcc4.8 和 更新autoconf，参考<a href="https://gist.github.com/tkuchiki/543e277a2f7221a7833a" target="_blank" rel="noopener">这里</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]# curl -L -O http://ftp.gnu.org/gnu/autoconf/autoconf-2.69.tar.gz</span><br><span class="line">[root@localhost opt]# tar zxf autoconf-2.69.tar.gz</span><br><span class="line">[root@localhost opt]# cd autoconf-2.69</span><br><span class="line">[root@localhost opt]# yum install -y openssl-devel</span><br><span class="line">[root@localhost opt]# ./configure</span><br><span class="line">[root@localhost opt]# make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">[root@localhost opt]#  wget http://people.centos.org/tru/devtools-2/devtools-2.repo -O /etc/yum.repos.d/devtools-2.repo</span><br><span class="line">[root@localhost opt]#  yum install -y devtoolset-2-gcc-c++ devtoolset-2-binutils</span><br><span class="line">[root@localhost opt]#  source /opt/rh/devtoolset-2/enable</span><br></pre></td></tr></table></figure></p>
<p>规则下载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">git clone https://github.com/SpiderLabs/owasp-modsecurity-crs.git</span><br><span class="line">cd owasp-modsecurity-crs/</span><br><span class="line">cp crs-setup.conf.example /usr/local/openresty/nginx/conf/crs-setup.conf</span><br><span class="line">cd rules</span><br><span class="line">cp REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf.example REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf</span><br><span class="line">cp RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf.example RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf</span><br></pre></td></tr></table></figure></p>
<p>添加modsecurity配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">cp /opt/ModSecurity/modsecurity.conf-recommended /usr/local/openresty/nginx/conf/modsecurity.conf</span><br><span class="line">cp /opt/ModSecurity/unicode.mapping /usr/local/openresty/nginx/conf/unicode.mapping</span><br><span class="line">cp cp *.data /usr/local/openresty/nginx/conf/owasp/rules</span><br><span class="line">cp cp *.conf /usr/local/openresty/nginx/conf/owasp/rules</span><br><span class="line">vi modsecurity.conf</span><br><span class="line">最后添加</span><br><span class="line">Include /usr/local/openresty/nginx/conf/crs-setup.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-901-INITIALIZATION.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-905-COMMON-EXCEPTIONS.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-910-IP-REPUTATION.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-911-METHOD-ENFORCEMENT.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-912-DOS-PROTECTION.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-913-SCANNER-DETECTION.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-921-PROTOCOL-ATTACK.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-930-APPLICATION-ATTACK-LFI.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-931-APPLICATION-ATTACK-RFI.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-933-APPLICATION-ATTACK-PHP.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-941-APPLICATION-ATTACK-XSS.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-943-APPLICATION-ATTACK-SESSION-FIXATION.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/REQUEST-949-BLOCKING-EVALUATION.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/RESPONSE-950-DATA-LEAKAGES.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/RESPONSE-951-DATA-LEAKAGES-SQL.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/RESPONSE-952-DATA-LEAKAGES-JAVA.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/RESPONSE-953-DATA-LEAKAGES-PHP.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/RESPONSE-954-DATA-LEAKAGES-IIS.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/RESPONSE-959-BLOCKING-EVALUATION.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/RESPONSE-980-CORRELATION.conf</span><br><span class="line">Include /usr/local/openresty/nginx/conf/owasp/rules/RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf</span><br><span class="line">#禁用某个规则方法</span><br><span class="line">#SecRuleRemoveById 949110</span><br><span class="line">#SecRuleRemoveById 920420</span><br><span class="line">#SecRuleRemoveById 931100</span><br></pre></td></tr></table></figure></p>
<p>默认只是检测，不拦截，可以修改配置，将<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SecRuleEngine DetectionOnly改为</span><br><span class="line">SecRuleEngine On</span><br></pre></td></tr></table></figure></p>
<p>编辑crs-setup.conf文件<br>默认ModSecurity不会阻挡恶意连接，只会记录在Log里。修改SecDefaultAction选项，默认开启阻挡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sed -ie &apos;s/SecDefaultAction &quot;phase:1,log,auditlog,pass&quot;/#SecDefaultAction &quot;phase:1,log,auditlog,pass&quot;/g&apos; crs-setup.conf</span><br><span class="line">$ sed -ie &apos;s/SecDefaultAction &quot;phase:2,log,auditlog,pass&quot;/#SecDefaultAction &quot;phase:2,log,auditlog,pass&quot;/g&apos; crs-setup.conf</span><br><span class="line">$ sed -ie &apos;s/#.*SecDefaultAction &quot;phase:1,log,auditlog,deny,status:403&quot;/SecDefaultAction &quot;phase:1,log,auditlog,deny,status:403&quot;/g&apos; crs-setup.conf</span><br><span class="line">$ sed -ie &apos;s/# SecDefaultAction &quot;phase:2,log,auditlog,deny,status:403&quot;/SecDefaultAction &quot;phase:2,log,auditlog,deny,status:403&quot;/g&apos; crs-setup.conf</span><br></pre></td></tr></table></figure></p>
<p>nginx中增加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">modsecurity on;</span><br><span class="line">modsecurity_rules_file /usr/local/openresty/nginx/conf/modsecurity.conf;</span><br></pre></td></tr></table></figure>
<p>重启nginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nginx restart</span><br></pre></td></tr></table></figure></p>
<p>打开modsecurity检测日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f /var/log/modsec_audit.log</span><br></pre></td></tr></table></figure></p>
<p>测试Modsecurity</p>
<p>在浏览器中访问默认首页，会看到Nginx默认的欢迎页<br>这时我们在网址后面自己加上正常参数，例如： <a href="http://localhost/?id=1" target="_blank" rel="noopener">http://localhost/?id=1</a> 。同样会看到Nginx默认的欢迎页：<br>接下来，我们在前面正常参数的基础上再加上 AND 1=1 ,整个请求变成： <a href="http://localhost/?id=1" target="_blank" rel="noopener">http://localhost/?id=1</a> AND 1=1<br>就会看到Nginx返回403 Forbidden的信息了，说明Modsecurity成功拦截了此请求。</p>
<p>出现的错误：</p>
<ol>
<li>未更新autoconf,更新即可<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ModSecurity]# sh build.sh </span><br><span class="line">libtoolize: putting auxiliary files in `.&apos;.</span><br><span class="line">libtoolize: copying file `./ltmain.sh&apos;</span><br><span class="line">libtoolize: putting macros in AC_CONFIG_MACRO_DIR, `build&apos;.</span><br><span class="line">libtoolize: copying file `build/libtool.m4&apos;</span><br><span class="line">libtoolize: copying file `build/ltoptions.m4&apos;</span><br><span class="line">libtoolize: copying file `build/ltsugar.m4&apos;</span><br><span class="line">libtoolize: copying file `build/ltversion.m4&apos;</span><br><span class="line">libtoolize: copying file `build/lt~obsolete.m4&apos;</span><br><span class="line">/usr/bin/m4:configure.ac:209: bad expression in eval: m4_esyscmd_s(cat headers/modsecurity/modsecurity.h | grep &quot;define MODSECURITY_MAJOR &quot; | awk &#123;&apos;print &apos;&#125; | sed &apos;s/\&quot;//g&apos;) + m4_esyscmd_s(cat headers/modsecurity/modsecurity.h | grep &quot;define MODSECURITY_MINOR &quot; | awk &#123;&apos;print &apos;&#125; | sed &apos;s/\&quot;//g&apos;)</span><br><span class="line">autom4te: /usr/bin/m4 failed with exit status: 1</span><br><span class="line">aclocal: autom4te failed with exit status: 1</span><br><span class="line">autoreconf: aclocal failed with exit status: 1</span><br><span class="line">/usr/bin/m4:configure.ac:209: bad expression in eval: m4_esyscmd_s(cat headers/modsecurity/modsecurity.h | grep &quot;define MODSECURITY_MAJOR &quot; | awk &#123;&apos;print &apos;&#125; | sed &apos;s/\&quot;//g&apos;) + m4_esyscmd_s(cat headers/modsecurity/modsecurity.h | grep &quot;define MODSECURITY_MINOR &quot; | awk &#123;&apos;print &apos;&#125; | sed &apos;s/\&quot;//g&apos;)</span><br><span class="line">autom4te: /usr/bin/m4 failed with exit status: 1</span><br><span class="line">autoheader: &apos;/usr/bin/autom4te&apos; failed with exit status: 1</span><br><span class="line">/usr/bin/m4:configure.ac:209: bad expression in eval: m4_esyscmd_s(cat headers/modsecurity/modsecurity.h | grep &quot;define MODSECURITY_MAJOR &quot; | awk &#123;&apos;print &apos;&#125; | sed &apos;s/\&quot;//g&apos;) + m4_esyscmd_s(cat headers/modsecurity/modsecurity.h | grep &quot;define MODSECURITY_MINOR &quot; | awk &#123;&apos;print &apos;&#125; | sed &apos;s/\&quot;//g&apos;)</span><br><span class="line">autom4te: /usr/bin/m4 failed with exit status: 1</span><br><span class="line">automake: autoconf failed with exit status: 1</span><br><span class="line">/usr/bin/m4:configure.ac:209: bad expression in eval: m4_esyscmd_s(cat headers/modsecurity/modsecurity.h | grep &quot;define MODSECURITY_MAJOR &quot; | awk &#123;&apos;print &apos;&#125; | sed &apos;s/\&quot;//g&apos;) + m4_esyscmd_s(cat headers/modsecurity/modsecurity.h | grep &quot;define MODSECURITY_MINOR &quot; | awk &#123;&apos;print &apos;&#125; | sed &apos;s/\&quot;//g&apos;)</span><br><span class="line">autom4te: /usr/bin/m4 failed with exit status: 1</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>ref</p>
<p><a href="https://docs.nginx.com/nginx-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs/" target="_blank" rel="noopener">Using the OWASP CRS with NGINX WAF</a><br><a href="https://fossies.org/linux/owasp-modsecurity-crs/INSTALL" target="_blank" rel="noopener">owasp-modsecurity-crs-3.0.2/INSTALL</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文不打算写安装过程，具体安装参考&lt;a href=&quot;https://github.com/SpiderLabs/ModSecurity/wiki/Compilation-recipes-for-v3.x&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;这里&lt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>How to config Kafka SASL zookeeper authentication</title>
    <link href="https://t1ger.github.io/2018/11/21/How-to-config-Kafka-SASL-zookeeper-authentication/"/>
    <id>https://t1ger.github.io/2018/11/21/How-to-config-Kafka-SASL-zookeeper-authentication/</id>
    <published>2018-11-21T09:06:00.000Z</published>
    <updated>2018-11-22T09:56:59.367Z</updated>
    
    <content type="html"><![CDATA[<p>单节点zookeeper配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost kafka]# cat /etc/zookeeper/zoo.cfg </span><br><span class="line"># The number of milliseconds of each tick</span><br><span class="line">tickTime=2000</span><br><span class="line"># The number of ticks that the initial </span><br><span class="line"># synchronization phase can take</span><br><span class="line">initLimit=10</span><br><span class="line"># The number of ticks that can pass between </span><br><span class="line"># sending a request and getting an acknowledgement</span><br><span class="line">syncLimit=5</span><br><span class="line"># the directory where the snapshot is stored.</span><br><span class="line">dataDir=/var/lib/zookeeper/data</span><br><span class="line"># the port at which the clients will connect</span><br><span class="line">clientPort=2181</span><br><span class="line"></span><br><span class="line">authProvider.1=org.apache.zookeeper.server.auth.SASLAuthenticationProvider</span><br><span class="line">requireClientAuthScheme=sasl</span><br><span class="line">jaasLoginRenew=3600000</span><br></pre></td></tr></table></figure></p>
<p>JAAS配置文件指定身份认证插件，并提供登录到zookeeper的登录名与密码。我创建了一个配置文件kafka_zoo_jaas.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Server &#123;</span><br><span class="line">  org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">    username=&quot;admin&quot;</span><br><span class="line">    password=&quot;admin&quot;</span><br><span class="line">    user_admin=&quot;admin&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>拷贝第三方Jar包到ZooKeeper目录,可以从<a href="https://mvnrepository.com/" target="_blank" rel="noopener">https://mvnrepository.com/</a> 查看需要的包依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kafka-clients-2.0.1.jar </span><br><span class="line">lz4-java-1.4.jar</span><br><span class="line">org.osgi.core-4.3.0.jar</span><br><span class="line">slf4j-api-1.7.25.jar</span><br><span class="line">snappy-java-1.1.4.jar</span><br></pre></td></tr></table></figure></p>
<p> /usr/local/kafka_2.12-1.1.1/config 目录下的   server.properties 文件 进行修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">listeners=SASL_PLAINTEXT://172.16.10.112:9092</span><br><span class="line">security.inter.broker.protocol=SASL_PLAINTEXT  </span><br><span class="line">sasl.enabled.mechanisms=PLAIN </span><br><span class="line">sasl.mechanism.inter.broker.protocol=PLAIN  </span><br><span class="line">authorizer.class.name=kafka.security.auth.SimpleAclAuthorizer</span><br><span class="line">allow.everyone.if.no.acl.found=true</span><br><span class="line">auto.create.topics.enable=false</span><br><span class="line">super.users=User:admin</span><br><span class="line">delete.topic.enable=true</span><br></pre></td></tr></table></figure>
<p>在config目录添加kafka_server_jaas.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">KafkaServer &#123;</span><br><span class="line">    org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">    username=&quot;admin&quot;</span><br><span class="line">    password=&quot;admin&quot;</span><br><span class="line">    user_admin=&quot;admin&quot;</span><br><span class="line">    user_kafka=&quot;kafka&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Client &#123;</span><br><span class="line">    org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">        username=&quot;admin&quot;</span><br><span class="line">        password=&quot;admin&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">KafkaClient &#123;</span><br><span class="line">    org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">            username=&quot;kafka&quot;</span><br><span class="line">            password=&quot;kafka&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>kafka-run-class.sh添加下面配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">KAFKA_SASL_OPTS=&quot;-Djava.security.auth.login.config=/opt/kafka/config/kafka_server_jaas.conf&quot;</span><br><span class="line"></span><br><span class="line"># Launch mode</span><br><span class="line">if [ &quot;x$DAEMON_MODE&quot; = &quot;xtrue&quot; ]; then</span><br><span class="line">  nohup $JAVA $KAFKA_HEAP_OPTS $KAFKA_JVM_PERFORMANCE_OPTS $KAFKA_GC_LOG_OPTS $KAFKA_SASL_OPTS $KAFKA_JMX_OPTS $KAFKA_LOG4J_OPTS -cp $CLASSPATH $KAFKA_OPTS &quot;$@&quot; &gt; &quot;$CONSOLE_OUTPUT_FILE&quot; 2&gt;&amp;1 &lt; /dev/null &amp;</span><br><span class="line">else</span><br><span class="line">  exec $JAVA $KAFKA_HEAP_OPTS $KAFKA_JVM_PERFORMANCE_OPTS $KAFKA_GC_LOG_OPTS $KAFKA_SASL_OPTS $KAFKA_JMX_OPTS $KAFKA_LOG4J_OPTS -cp $CLASSPATH $KAFKA_OPTS &quot;$@&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>kafka已经开启了SASL/PLAIN权限认证,producer和consumer不做配置是无法连接kafka的<br>在config目录下创建kafka_client_jaas.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">KafkaClient &#123;</span><br><span class="line">        org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">        username=&quot;kafka&quot;</span><br><span class="line">        password=&quot;kafka&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>在config下的producer.properties和consumer.properties添加下面配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security.protocol=SASL_PLAINTEXT</span><br><span class="line">sasl.mechanism=PLAIN</span><br></pre></td></tr></table></figure></p>
<p>在bin下的kafka-console-producer.sh和kafka-console-consumer.sh下添加下面配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if [ &quot;x$KAFKA_OPTS&quot; ]; then</span><br><span class="line"> export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/opt/kafka/config/kafka_client_jaas.conf&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></p>
<p>为你需要使用的用户授权<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-acls.sh --authorizer-properties zookeeper.connect=localhost:2181/kafka --add --allow-principal User:alice --operation Read --operation Write --topic sean-security</span><br></pre></td></tr></table></figure></p>
<p>查询已经授权的用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-acls.sh --authorizer-properties zookeeper.connect=localhost:2181/kafka --list --topic sean-security</span><br></pre></td></tr></table></figure>
<p>配置完成后，测试下,注意如果有开机自启,需要修改相应脚本,加载KAFKA_OPTS 选项<br>创建topic<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kafka-topics.sh  --zookeeper localhost:2181/kafka --create --topic Test  --partitions 1 --replication-factor 1</span><br></pre></td></tr></table></figure></p>
<p>producer发送消息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">./kafka-console-producer.sh --broker-list 172.16.10.100:9092 --topic test</span><br><span class="line">--producer.config /opt/kafk/config/producer.properties</span><br></pre></td></tr></table></figure></p>
<p>consumer消费消息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./kafka-console-consumer.sh --bootstrap-server 172.16.10.100:9092 --topic test --from-beginning</span><br><span class="line"> --consumer.config /opt/kafk/config/consumer.properties</span><br></pre></td></tr></table></figure></p>
<p>如果是在程序里面只需要在kafka配置信息里添加如下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">System.setProperty(&quot;java.security.auth.login.config&quot;, &quot;kafka_client_jaas.conf&quot;); // 环境变量添加，需要输入配置文件的路径</span><br><span class="line">propsMap.put(&quot;security.protocol&quot;,&quot;SASL_PLAINTEXT&quot;);</span><br><span class="line">propsMap.put(&quot;sasl.mechanism&quot;, &quot;PLAIN&quot;);</span><br></pre></td></tr></table></figure></p>
<p>无论是producer还是consumer，都需要配置认证信息，其中kafka_client_jaas.conf的内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">KafkaClient &#123;</span><br><span class="line">        org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">        username=&quot;kafka&quot;</span><br><span class="line">        password=&quot;kafka&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>ref<br><a href="http://kafka.apache.org/documentation/" target="_blank" rel="noopener">Documentation</a><br><a href="https://blog.csdn.net/u012040869/article/details/82589002?utm_source=blogkpcl4" target="_blank" rel="noopener">为Kafka 添加用户名 密码权限，即SASL/PLAIN</a><br><a href="http://www.2bowl.info/kafka%E7%9A%84saslplain%E8%AE%A4%E8%AF%81%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E/" target="_blank" rel="noopener">Kafka的SASL/PLAIN认证配置说明</a><br><a href="https://stackoverflow.com/questions/43469962/kafka-sasl-zookeeper-authentication" target="_blank" rel="noopener">Kafka SASL zookeeper authentication</a><br><a href="https://blog.csdn.net/u012842205/article/details/73188534?utm_source=blogxgwz0" target="_blank" rel="noopener">单机节点Kafka配置SASL用户名密码认证</a><br><a href="https://blog.csdn.net/u010416101/article/details/79562214" target="_blank" rel="noopener">Kafka SASL配置 &amp; Demo测试</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;单节点zookeeper配置&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>How to install Cabot on CentOS</title>
    <link href="https://t1ger.github.io/2018/11/14/How-to-install-Cabot-on-CentOS/"/>
    <id>https://t1ger.github.io/2018/11/14/How-to-install-Cabot-on-CentOS/</id>
    <published>2018-11-14T09:56:36.000Z</published>
    <updated>2018-11-15T06:11:12.188Z</updated>
    
    <content type="html"><![CDATA[<p>Cabot环境搭建</p>
<p>初始化mysql数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root -p -e &quot;CREATE USER cabot@localhost IDENTIFIED BY &apos;cabot&apos;&quot;;</span><br><span class="line">$ mysql -u root -p -e &quot;CREATE DATABASE cabot&quot;;</span><br><span class="line">$ mysql -u root -p -e &quot;GRANT ALL PRIVILEGES ON \`cabot\`.* TO \`cabot\`@localhost&quot;;</span><br></pre></td></tr></table></figure></p>
<p>下载cabot</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/arachnys/cabot.git</span><br></pre></td></tr></table></figure>
<p>安装依赖软件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install ruby</span><br><span class="line">$ sudo gem install foreman</span><br><span class="line">$ sudo pip install fabric</span><br><span class="line">$ sudo yum install python-devel</span><br><span class="line">$ sudo yum install openldap-devel</span><br><span class="line">$ sudo pip install -r requirements.txt </span><br><span class="line">$ sudo pip install -r requirements-plugins.txt </span><br><span class="line">$ sudo pip install -r requirements-dev.txt</span><br><span class="line">$ sudo pip install MySQL-python</span><br><span class="line">$ sudo yum install nodejs</span><br><span class="line">$ sudo npm install -g less</span><br><span class="line">$ sudo npm install -g coffee-script</span><br></pre></td></tr></table></figure></p>
<p>修改配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ cp production.env.example production.env</span><br><span class="line">$ vi production.env</span><br><span class="line">DEBUG=t</span><br><span class="line">DATABASE_URL=mysql://cabot:cabot@localhost:3306/cabot</span><br><span class="line">DJANGO_SETTINGS_MODULE=cabot.settings</span><br><span class="line">LOG_FILE=log</span><br><span class="line">PORT=5008</span><br><span class="line"></span><br><span class="line"># Local time zone for this installation. Choices can be found here:</span><br><span class="line"># http://en.wikipedia.org/wiki/List_of_tz_zones_by_name</span><br><span class="line">TIME_ZONE=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"># Django settings</span><br><span class="line">CELERY_BROKER_URL=redis://localhost:6379/1</span><br><span class="line">DJANGO_SECRET_KEY=2FL6ORhHwr5eX34pP9mMugnIOd3jzVuT45f7w430Mt5PnEwbcJgma0q8zUXNZ68A</span><br><span class="line"></span><br><span class="line"># Hostname of your Graphite server instance</span><br><span class="line">GRAPHITE_API=http://*.*.*.*:12346/</span><br><span class="line">GRAPHITE_USER=username</span><br><span class="line">GRAPHITE_PASS=password</span><br></pre></td></tr></table></figure></p>
<p>修改启动文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ vi .foreman</span><br><span class="line"></span><br><span class="line"># vi: set ft=yaml :</span><br><span class="line">procfile: Procfile</span><br><span class="line">env: conf/production.env</span><br><span class="line"></span><br><span class="line">$ vi gunicorn.conf</span><br><span class="line"></span><br><span class="line"># -*- mode: python -*-</span><br><span class="line"># vi: set ft=python :</span><br><span class="line">import os</span><br><span class="line">bind = &apos;0.0.0.0:%s&apos; % os.environ[&apos;PORT&apos;]</span><br><span class="line">workers = 3</span><br><span class="line"></span><br><span class="line">$ vi Procfile</span><br><span class="line">web:       gunicorn cabot.wsgi:application --config gunicorn.conf</span><br><span class="line">celery:    celery worker -B -A cabot --loglevel=INFO --concurrency=16 -Ofair</span><br><span class="line">beat:      celery beat -A cabot --loglevel=INFO</span><br></pre></td></tr></table></figure></p>
<p>初始化数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sh setup_dev.sh</span><br></pre></td></tr></table></figure></p>
<p>启动web程序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ foreman start web</span><br></pre></td></tr></table></figure></p>
<p>启动celery<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foreman start celery</span><br></pre></td></tr></table></figure></p>
<p>登录管理页面(第一次登录需要设置管理员账号)</p>
<p>使用supervisor管理Cabot,Celery进程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/supervisord.d/cabot.conf</span><br><span class="line"></span><br><span class="line">[program:web]</span><br><span class="line">command=foreman start web</span><br><span class="line">autorstart=true</span><br><span class="line">autorestart=true</span><br><span class="line">redirect_stderr=true</span><br><span class="line">stopsignal=TERM</span><br><span class="line">stdout_logfile=/var/log/web.log</span><br><span class="line">directory=/opt/cabot</span><br><span class="line"></span><br><span class="line">[program:celery]</span><br><span class="line">command=foreman start celery</span><br><span class="line">autorstart=true</span><br><span class="line">autorestart=true</span><br><span class="line">redirect_stderr=true</span><br><span class="line">stopsignal=TERM</span><br><span class="line">stdout_logfile=/var/log/celery.log</span><br><span class="line">directory=/opt/cabot</span><br></pre></td></tr></table></figure></p>
<p>使用supervisor管理程序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo supervisorctl reload</span><br></pre></td></tr></table></figure></p>
<p>遇到的错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. &quot;Missing staticfiles manifest entry for &apos;%s&apos;&quot; % clean_name</span><br><span class="line">#解决方法</span><br><span class="line">python manage.py collectstatic</span><br><span class="line"></span><br><span class="line">2. CommandError: An error occurred during rendering /usr/local/whistle/webapps/cabot/cabot/templates/cabotapp/statuscheck_report.html:</span><br><span class="line"> /bin/sh: lessc: command not found</span><br><span class="line">#解决方法</span><br><span class="line">pip install nodeenv</span><br><span class="line">nodeenv nodeenv</span><br><span class="line">source nodeenv/bin/activate</span><br><span class="line">npm install -g less</span><br></pre></td></tr></table></figure></p>
<p>ref<br><a href="https://my.oschina.net/cdsc/blog/1480219" target="_blank" rel="noopener">Cabot Alert Mysql环境搭建</a><br><a href="https://github.com/ialbert/biostar-central/issues/193" target="_blank" rel="noopener">Cannot run Biostars out of the box: “lessc: command not found”</a><br><a href="https://stackoverflow.com/questions/44160666/valueerror-missing-staticfiles-manifest-entry-for-favicon-ico" target="_blank" rel="noopener">ValueError: Missing staticfiles manifest entry for ‘favicon.ico’</a></p>
<hr>
<p>您的鼓励是我写作最大的动力</p>
<p>俗话说，投资效率是最好的投资。 如果您感觉我的文章质量不错，读后收获很大，预计能为您提高 10% 的工作效率，不妨小额捐助我一下，让我有动力继续写出更多好文章。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Cabot环境搭建&lt;/p&gt;
&lt;p&gt;初始化mysql数据库&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span c
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>mysql audit plugin</title>
    <link href="https://t1ger.github.io/2018/11/05/mysql-audit-plugin/"/>
    <id>https://t1ger.github.io/2018/11/05/mysql-audit-plugin/</id>
    <published>2018-11-05T09:40:06.000Z</published>
    <updated>2018-11-05T09:59:45.781Z</updated>
    
    <content type="html"><![CDATA[<p>此文转载于<a href="https://blog.csdn.net/heizistudio/article/details/50954294" target="_blank" rel="noopener">ora600</a>,略作调整.</p>
<p>下载地址如下<br><a href="http://pan.baidu.com/s/1dFGFCrv" target="_blank" rel="noopener">http://pan.baidu.com/s/1dFGFCrv</a></p>
<p>mysql5.6.X.tar.gz到mysql-5.7.8-rc.tar.gz是一个版本—-audit5_6_21.so<br>mysql5.7.1.tar.gz—mysql5.7.9.tar.gz是一个版本—-audit5_7_9.so<br>mysql5.7.10–mysql5.7.22是一个版本</p>
<p>一、查找插件所在位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &apos;%plugin_dir%&apos;;</span><br><span class="line">+---------------+------------------------------+</span><br><span class="line">| Variable_name | Value                        |</span><br><span class="line">+---------------+------------------------------+</span><br><span class="line">| plugin_dir    | /usr/local/mysql/lib/plugin/ |</span><br><span class="line">+---------------+------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">---------------------</span><br></pre></td></tr></table></figure></p>
<p>二、将audit_版本号.so插件下载后放到plugin_dir位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv audit_版本号.so  audit.so</span><br></pre></td></tr></table></figure></p>
<p>三、加载插件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; install plugin audit  SONAME &apos;audit.so&apos;;</span><br></pre></td></tr></table></figure></p>
<p>四、卸载插件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; uninstall plugin audit;</span><br></pre></td></tr></table></figure></p>
<p>使用插件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &apos;%audit%&apos;;</span><br><span class="line">+----------------+----------------------+</span><br><span class="line">| Variable_name  | Value                |</span><br><span class="line">+----------------+----------------------+</span><br><span class="line">| audit_logfile  | /tmp/mysql_audit.log |</span><br><span class="line">| audit_myswitch | OFF                  |</span><br><span class="line">| audit_num      | 0                    |</span><br><span class="line">| audit_sql      | all_sql              |</span><br><span class="line">| audit_user     | all_user             |</span><br><span class="line">+----------------+----------------------+</span><br><span class="line">5 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set global audit_logfile=&apos;/tmp/mysql_audit_1.log&apos;;----只读变量，审计仅指定在/tmp/mysql_audit.log文件，保障权限可以写</span><br><span class="line">ERROR 1238 (HY000): Variable &apos;audit_logfile&apos; is a read only variable</span><br><span class="line"></span><br><span class="line">set global audit_sql=&apos;delete;select;drop&apos;;   -----这些审计关键字用;分开</span><br><span class="line">set global audit_user=&apos;user2;user3&apos;;         ----审计用户用;隔开</span><br><span class="line">set global audit_num =0;                          ----审计sql影响的最少行数，默认为0</span><br><span class="line">set global audit_myswitch=on|off|ON|OFF|1|0;       -----开启关闭审计</span><br></pre></td></tr></table></figure></p>
<p>查看日志linux下tailf /tmp/mysql_audit.log</p>
<p>ref<br><a href="https://blog.csdn.net/heizistudio/article/details/50954294" target="_blank" rel="noopener">mysql审计插件(运维不在背锅)</a><br><a href="https://dev.mysql.com/doc/refman/5.5/en/writing-audit-plugins.html" target="_blank" rel="noopener">Writing Audit Plugins</a><br><a href="https://github.com/mcafee/mysql-audit/wiki/Configuration" target="_blank" rel="noopener">mcafee/mysql-audit</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;此文转载于&lt;a href=&quot;https://blog.csdn.net/heizistudio/article/details/50954294&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ora600&lt;/a&gt;,略作调整.&lt;/p&gt;
&lt;p&gt;下载地址如下&lt;b
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Spark On YARN</title>
    <link href="https://t1ger.github.io/2018/10/30/Spark-On-YARN/"/>
    <id>https://t1ger.github.io/2018/10/30/Spark-On-YARN/</id>
    <published>2018-10-30T07:27:47.000Z</published>
    <updated>2018-10-30T10:02:56.495Z</updated>
    
    <content type="html"><![CDATA[<h5 id="Deployment-Modes"><a href="#Deployment-Modes" class="headerlink" title="Deployment Modes"></a><b>Deployment Modes</b></h5><p>在YARN中，每个应用实例有一个ApplicationMaster进程，这是应用实例开启的第一个容器。 ResourceManager向ApplicationMaster申请资源，<br>在资源分配后，应用实例会通知NodeManagers去启动容器。ApplicationMasters 评估每个客户端的需要:进程启动的应用可以被中断，持续协调管理进程。</p>
<h5 id="Cluster-Deployment-Mode"><a href="#Cluster-Deployment-Mode" class="headerlink" title="Cluster Deployment Mode"></a><b>Cluster Deployment Mode</b></h5><p>在集群模式，Spark driver 运行在ApplicationMaster集群主机里边，在Yarn容器里的进程负责驱动应用和向YARN请求资源。<br>集群模式不适合交互<br><img src="https://www.cloudera.com/documentation/enterprise/latest/images/xspark-yarn-cluster.png.pagespeed.ic.f4CfMwda2i.webp" alt="cluster mode"></p>
<h5 id="Cluster-Deployment-Mode-1"><a href="#Cluster-Deployment-Mode-1" class="headerlink" title="Cluster Deployment Mode"></a><b>Cluster Deployment Mode</b></h5><p>在客户端模式，Spark driver运行在提交job的主机上,ApplicationMaster响应来自于Yarn容器的请求，在容器启动后，客户端和容器协调完成任务调度<br><img src="https://www.cloudera.com/documentation/enterprise/latest/images/xspark-yarn-client.png.pagespeed.ic.Nm0CUtnR01.webp" alt="client mode"></p>
<h5 id="Configuring-the-Environment"><a href="#Configuring-the-Environment" class="headerlink" title="Configuring the Environment"></a><b>Configuring the Environment</b></h5><p>Spark 需要配置 HADOOP_CONF_DIR or YARN_CONF_DIR 环境变量指向包含客户端目录的配置文件，这些配置文件用于写入HDFS和连接YARN ResourceManager.如果使用Cloudera Manager的部署客户端配置，这些变量会自动配置好.<br>否则在提交job会出现如下错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.Exception: When running with master &apos;yarn&apos; either HADOOP_CONF_DIR or YARN_CONF_DIR must be set in the environment.</span><br><span class="line">    at org.apache.spark.deploy.SparkSubmitArguments.validateSubmitArguments(SparkSubmitArguments.scala:251)</span><br><span class="line">    at org.apache.spark.deploy.SparkSubmitArguments.validateArguments(SparkSubmitArguments.scala:228)</span><br><span class="line">    at org.apache.spark.deploy.SparkSubmitArguments.&lt;init&gt;(SparkSubmitArguments.scala:109)</span><br><span class="line">    at org.apache.spark.deploy.SparkSubmit$.main(SparkSubmit.scala:114)</span><br></pre></td></tr></table></figure></p>
<h5 id="Running-a-Spark-Shell-Application-on-YARN"><a href="#Running-a-Spark-Shell-Application-on-YARN" class="headerlink" title="Running a Spark Shell Application on YARN"></a><b>Running a Spark Shell Application on YARN</b></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#launch a Spark application in cluster mode</span><br><span class="line">[root@cdh2 admin]# cat job.sh </span><br><span class="line">sudo -uhdfs  spark-submit --class org.apache.spark.examples.SparkPi \</span><br><span class="line">    --verbose \</span><br><span class="line">    --master yarn \</span><br><span class="line">    --deploy-mode cluster\</span><br><span class="line">    --num-executors 3 \</span><br><span class="line">    --driver-memory 2g \</span><br><span class="line">    --executor-memory 512m \</span><br><span class="line">    --executor-cores 1 \</span><br><span class="line">    --queue thequeue \</span><br><span class="line">    /opt/cloudera/parcels/CDH-6.0.1-1.cdh6.0.1.p0.590678/lib/spark/examples/jars/spark-examples_2.11-2.2.0-cdh6.0.1.jar \</span><br><span class="line">    10 </span><br><span class="line"></span><br><span class="line">#run spark-shell in client mode:	</span><br><span class="line"> ./bin/spark-shell --master yarn --deploy-mode client</span><br></pre></td></tr></table></figure>
<h5 id="Spark-On-YARN相关的配置参数"><a href="#Spark-On-YARN相关的配置参数" class="headerlink" title="Spark On YARN相关的配置参数"></a><b>Spark On YARN相关的配置参数</b></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">spark.driver.memory ：默认值512m</span><br><span class="line">spark.executor.memory ：默认值512m</span><br><span class="line">spark.yarn.am.memory ：默认值512m</span><br><span class="line">spark.yarn.executor.memoryOverhead ：值为 executorMemory * 0.07, with minimum of 384</span><br><span class="line">spark.yarn.driver.memoryOverhead ：值为 driverMemory * 0.07, with minimum of 384</span><br><span class="line">spark.yarn.am.memoryOverhead ：值为 AM memory * 0.07, with minimum of 384</span><br><span class="line"></span><br><span class="line">#--executor-memory/spark.executor.memory 控制 executor 的堆的大小，但是 JVM 本身也会占用一定的堆空间，比如内部的 String 或者直接 byte buffer， spark.yarn.XXX.memoryOverhead 属性决定向 YARN 请求的每个 executor 或dirver或am 的额外堆内存大小，默认值为 max(384, 0.07 * spark.executor.memory )</span><br><span class="line">#在 executor 执行的时候配置过大的 memory 经常会导致过长的GC延时，64G是推荐的一个 executor 内存大小的上限。</span><br><span class="line">#HDFS client 在大量并发线程时存在性能问题。大概的估计是每个 executor 中最多5个并行的 task 就可以占满写入带宽</span><br></pre></td></tr></table></figure>
<p>YARN中有几个关键参数，参考YARN的内存和CPU配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yarn.app.mapreduce.am.resource.mb ：AM能够申请的最大内存，默认值为1536MB</span><br><span class="line">yarn.nodemanager.resource.memory-mb ：nodemanager能够申请的最大内存，默认值为8192MB</span><br><span class="line">yarn.scheduler.minimum-allocation-mb ：调度时一个container能够申请的最小资源，默认值为1024MB</span><br><span class="line">yarn.scheduler.maximum-allocation-mb ：调度时一个container能够申请的最大资源，默认值为8192MB</span><br></pre></td></tr></table></figure></p>
<p>设置AM申请的内存值，要么使用cluster模式，要么在client模式中，是有 –conf 手动设置 spark.yarn.am.memory 属性，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo -uhdfs  spark-submit --class org.apache.spark.examples.SparkPi \</span><br><span class="line">    --verbose \</span><br><span class="line">    --master yarn \</span><br><span class="line">    --deploy-mode cluster\</span><br><span class="line">    --num-executors 3 \</span><br><span class="line">    --driver-memory 2g \</span><br><span class="line">    --executor-memory 512m \</span><br><span class="line">    --executor-cores 1 \</span><br><span class="line">	--conf spark.yarn.am.memory=1024m \rr</span><br><span class="line">    --queue thequeue \</span><br><span class="line">    /opt/cloudera/parcels/CDH-6.0.1-1.cdh6.0.1.p0.590678/lib/spark/examples/jars/spark-examples_2.11-2.2.0-cdh6.0.1.jar \</span><br><span class="line">    10</span><br></pre></td></tr></table></figure></p>
<p>ref<br><a href="https://www.cloudera.com/documentation/enterprise/latest/topics/cdh_ig_running_spark_on_yarn.html" target="_blank" rel="noopener">Running Spark Applications on YARN</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h5 id=&quot;Deployment-Modes&quot;&gt;&lt;a href=&quot;#Deployment-Modes&quot; class=&quot;headerlink&quot; title=&quot;Deployment Modes&quot;&gt;&lt;/a&gt;&lt;b&gt;Deployment Modes&lt;/b&gt;&lt;/h5&gt;&lt;p&gt;在YARN中，
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>how to cleanup keys without exipiration in Redis</title>
    <link href="https://t1ger.github.io/2018/10/24/how-to-cleanup-keys-without-exipiration-in-Redis/"/>
    <id>https://t1ger.github.io/2018/10/24/how-to-cleanup-keys-without-exipiration-in-Redis/</id>
    <published>2018-10-24T04:02:18.000Z</published>
    <updated>2018-10-24T03:29:42.634Z</updated>
    
    <content type="html"><![CDATA[<p>在排查redis内存一直增长问题的时候，我们首先想到的是如何找出有多少key没有设置失效时间</p>
<p>我们可以通过 info keyspace 命令查看：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info keyspace</span><br><span class="line"># Keyspace</span><br><span class="line">db0:keys=473688,expires=1645,avg_ttl=1625894</span><br></pre></td></tr></table></figure></p>
<p>keys是总共的key, expires是要失效的key,ave_ttl是这些key的平均失效时间，单位是ms</p>
<p>注意，我们不能再生产环境使用keys命令，如果没有开启RDB,需要通过执行bgsave 来获得rdb文件，之后拷贝到测试环境</p>
<p>我们可以使用docker来加载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --name redis_dump -d -v `pwd`:/data -p 6379 redis:3.2</span><br><span class="line"></span><br><span class="line">docker exec -ti redis_dump bash</span><br></pre></td></tr></table></figure></p>
<p>现在我们来统计未设置失效时间的key吧<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis-cli keys &quot;*&quot; &gt; keys</span><br><span class="line">cat keys | xargs -n 1 -L 1 redis-cli ttl &gt; ttl</span><br><span class="line">paste -d &quot; &quot; keys ttl | grep .*-1$ | cut -d &quot; &quot; -f 1 &gt; without_ttl</span><br><span class="line"></span><br><span class="line"># We can create a script for deleting the keys </span><br><span class="line">cat without_ttl | awk &apos;&#123;print &quot;redis-cli del &quot;$1&#125;&apos; &gt; redis.sh</span><br></pre></td></tr></table></figure></p>
<p>再来一个大红包吧，怎么找出最大的key呢<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# redis-cli --bigkeys</span><br><span class="line"></span><br><span class="line"># Scanning the entire keyspace to find biggest keys as well as</span><br><span class="line"># average sizes per key type.  You can use -i 0.1 to sleep 0.1 sec</span><br><span class="line"># per 100 SCAN commands (not usually needed).</span><br><span class="line"></span><br><span class="line">[00.00%] Biggest string found so far &apos;courseinfo_201703827_2018-10-29&apos; with 14189 bytes</span><br><span class="line">[00.00%] Biggest string found so far &apos;courseinfo_3160205116_2017-09-04&apos; with 16717 bytes</span><br><span class="line">[00.01%] Biggest string found so far &apos;courseinfo_201707708_2018-12-03&apos; with 20835 bytes</span><br><span class="line">[00.02%] Biggest string found so far &apos;courseinfo_3170204119_2017-10-02&apos; with 23037 bytes</span><br><span class="line">[00.07%] Biggest string found so far &apos;courseinfo_3160204209_2017-09-18&apos; with 29201 bytes</span><br><span class="line">[00.38%] Biggest string found so far &apos;courseinfo_201504330342_2018-05-21&apos; with 138565 bytes</span><br><span class="line">[00.77%] Biggest string found so far &apos;courseinfo_201606060919_2018-03-26&apos; with 201381 bytes</span><br><span class="line">[00.98%] Biggest string found so far &apos;courseinfo_201501310518_2018-05-14&apos; with 215428 bytes</span><br><span class="line">[01.07%] Biggest string found so far &apos;courseinfo_201706061709_2018-06-11&apos; with 223421 bytes</span><br><span class="line">[04.43%] Biggest string found so far &apos;courseinfo_201706061633_2018-03-05&apos; with 249319 bytes</span><br><span class="line">[05.33%] Biggest string found so far &apos;courseinfo_201706062917_2018-03-05&apos; with 278392 bytes</span><br><span class="line">[06.03%] Biggest string found so far &apos;courseinfo_201707030224_2018-03-19&apos; with 281098 bytes</span><br><span class="line">[19.89%] Biggest string found so far &apos;courseinfo_201706062917_2018-03-19&apos; with 296014 bytes</span><br><span class="line"></span><br><span class="line">-------- summary -------</span><br><span class="line"></span><br><span class="line">Sampled 472908 keys in the keyspace!</span><br><span class="line">Total key length in bytes is 17874174 (avg len 37.80)</span><br><span class="line"></span><br><span class="line">Biggest string found &apos;courseinfo_201706062917_2018-03-19&apos; has 296014 bytes</span><br><span class="line"></span><br><span class="line">472908 strings with 2259279653 bytes (100.00% of keys, avg size 4777.42)</span><br><span class="line">0 lists with 0 items (00.00% of keys, avg size 0.00)</span><br><span class="line">0 sets with 0 members (00.00% of keys, avg size 0.00)</span><br><span class="line">0 hashs with 0 fields (00.00% of keys, avg size 0.00)</span><br><span class="line">0 zsets with 0 members (00.00% of keys, avg size 0.00)</span><br></pre></td></tr></table></figure></p>
<p>很快我们就会发现我们的问题了，courseinfo_201706062917_2018-03-19 就是我们要找的</p>
<p>ref<br><a href="https://jmaitrehenry.ca/2017/11/22/found-keys-without-expiration-in-redis/" target="_blank" rel="noopener">Found and cleanup keys without expiration in Redis</a></p>
<hr>
<p>您的鼓励是我写作最大的动力</p>
<p>俗话说，投资效率是最好的投资。 如果您感觉我的文章质量不错，读后收获很大，预计能为您提高 10% 的工作效率，不妨小额捐助我一下，让我有动力继续写出更多好文章。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在排查redis内存一直增长问题的时候，我们首先想到的是如何找出有多少key没有设置失效时间&lt;/p&gt;
&lt;p&gt;我们可以通过 info keyspace 命令查看：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>How to install CDH6.0 Cluster on Centos7.5</title>
    <link href="https://t1ger.github.io/2018/09/03/How-to-install-CDH6-0-Cluster-on-Centos7-5/"/>
    <id>https://t1ger.github.io/2018/09/03/How-to-install-CDH6-0-Cluster-on-Centos7-5/</id>
    <published>2018-09-03T02:21:26.000Z</published>
    <updated>2018-09-03T10:22:33.977Z</updated>
    
    <content type="html"><![CDATA[<h5 id="Cloudera-简介"><a href="#Cloudera-简介" class="headerlink" title="Cloudera 简介"></a><b>Cloudera 简介</b></h5><ul>
<li>Cloudera 官网：<a href="https://www.cloudera.com" target="_blank" rel="noopener">https://www.cloudera.com</a></li>
<li>Cloudera 官方文档： <a href="https://www.cloudera.com/documentation/enterprise/latest.html" target="_blank" rel="noopener">https://www.cloudera.com/documentation/enterprise/latest.html</a></li>
</ul>
<h5 id="安装Cloudera-Manager和CDH"><a href="#安装Cloudera-Manager和CDH" class="headerlink" title="安装Cloudera Manager和CDH"></a><b>安装Cloudera Manager和CDH</b></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">系统环境：CentOS7.5 </span><br><span class="line">软件环境：Oracle JDK、Cloudera Manager Server 和 Agent 、数据库、CDH各组件</span><br></pre></td></tr></table></figure>
<ul>
<li><p>系统初始化<br>关闭防火墙 禁用selinux,服务器之间免密，时间保持同步</p>
</li>
<li><p>Cloudera安装,官方文档参考<a href="https://www.cloudera.com/documentation/enterprise/6/6.0/topics/install_cm_cdh.html" target="_blank" rel="noopener">这里</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#Configure a Repository</span><br><span class="line">wget https://archive.cloudera.com/cm6/6.0.0/redhat7/yum/cloudera-manager.repo -P /etc/yum.repos.d/</span><br><span class="line">sudo rpm --import https://archive.cloudera.com/cm6/6.0.0/redhat7/yum/RPM-GPG-KEY-cloudera</span><br><span class="line"></span><br><span class="line">#Installing the JDK</span><br><span class="line">sudo yum install oracle-j2sdk1.8</span><br><span class="line"></span><br><span class="line">#Install Cloudera Manager Packages</span><br><span class="line">sudo yum install cloudera-manager-daemons cloudera-manager-agent cloudera-manager-server</span><br><span class="line"></span><br><span class="line">#Install Databases</span><br><span class="line">wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">sudo rpm -ivh mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">sudo yum update</span><br><span class="line">sudo yum install mysql-server</span><br><span class="line">sudo systemctl start mysqld</span><br><span class="line"></span><br><span class="line">#Set up the Cloudera Manager Database</span><br><span class="line">1. /opt/cloudera/cm/schema/scm_prepare_database.sh \</span><br><span class="line">[options] &lt;databaseType&gt; &lt;databaseName&gt; &lt;databaseUser&gt; &lt;password&gt;</span><br><span class="line">2. If it exists, remove the embedded PostgreSQL properties file:</span><br><span class="line">sudo rm /etc/cloudera-scm-server/db.mgmt.properties</span><br><span class="line"></span><br><span class="line">Example：</span><br><span class="line">sudo /opt/cloudera/cm/schema/scm_prepare_database.sh mysql scm scm</span><br><span class="line"></span><br><span class="line">#Install CDH and Other Software</span><br><span class="line">sudo systemctl start cloudera-scm-server</span><br><span class="line"></span><br><span class="line">we go to browser http://&lt;server_host&gt;:7180,login admin/admin</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建必需的数据库，可以参考<a href="https://www.cloudera.com/documentation/enterprise/latest/topics/install_cm_mariadb.html" target="_blank" rel="noopener">这里</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">create database metastore DEFAULT CHARACTER SET utf8;</span><br><span class="line">grant all on metastore.* TO &apos;hive&apos;@&apos;%&apos; IDENTIFIED BY &apos;hive&apos;;</span><br><span class="line"></span><br><span class="line">create database amon DEFAULT CHARACTER SET utf8;</span><br><span class="line">grant all on amon.* TO &apos;amon&apos;@&apos;%&apos; IDENTIFIED BY &apos;amon&apos;;</span><br><span class="line"></span><br><span class="line">create database hue DEFAULT CHARACTER SET utf8;</span><br><span class="line">grant all on hue.* TO &apos;hue&apos;@&apos;%&apos; IDENTIFIED BY &apos;hue&apos;;</span><br><span class="line"></span><br><span class="line">create database rman DEFAULT CHARACTER SET utf8;</span><br><span class="line">grant all on rman.* TO &apos;rman&apos;@&apos;%&apos; IDENTIFIED BY &apos;rman&apos;;</span><br><span class="line"></span><br><span class="line">create database navms DEFAULT CHARACTER SET utf8;</span><br><span class="line">grant all on navms.* TO &apos;navms&apos;@&apos;%&apos; IDENTIFIED BY &apos;navms&apos;;</span><br><span class="line"></span><br><span class="line">create database nas DEFAULT CHARACTER SET utf8;</span><br><span class="line">grant all on nas.* TO &apos;nas&apos;@&apos;%&apos; IDENTIFIED BY &apos;nas&apos;;</span><br><span class="line"></span><br><span class="line">create database oos DEFAULT CHARACTER SET utf8;</span><br><span class="line">grant all on oos.* TO &apos;oos&apos;@&apos;%&apos; IDENTIFIED BY &apos;oos&apos;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="卸载重装CM服务"><a href="#卸载重装CM服务" class="headerlink" title="卸载重装CM服务"></a><b>卸载重装CM服务</b></h5><p>如果，第一次没有安装成功，那这部分就对你有帮助了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 安装CDH manager的服务器上面执行</span><br><span class="line">yum remove cloudera-manager-server -y</span><br><span class="line"></span><br><span class="line"># 在所有的服务器执行下面操作</span><br><span class="line">systemctl stop  cloudera-scm-agent</span><br><span class="line">yum remove cloudera-manager-agennt-y</span><br><span class="line">ps -ef | grep cmf | grep -v grep | awk &apos;&#123;print $2&#125;&apos; | xargs kill -9</span><br><span class="line">find / -name clouder* | xargs rm -rf </span><br><span class="line">find / -name cmf* | xargs rm -rf</span><br></pre></td></tr></table></figure></p>
<h5 id="Custom-Installation-Solutions"><a href="#Custom-Installation-Solutions" class="headerlink" title="Custom Installation Solutions"></a><b>Custom Installation Solutions</b></h5><p>如果在线安装很慢，我们可以通过以下方式来加速安装</p>
<ul>
<li><p>Creating a Permanent Internal Repository(Option)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#Setting Up a Web Server</span><br><span class="line">sudo yum install httpd</span><br><span class="line">sudo systemctl start httpd</span><br><span class="line"></span><br><span class="line">#Edit the Apache HTTP Server configuration file (/etc/httpd/conf/httpd.conf by default) to add or edit the following line in the &lt;IfModule mime_module&gt; section:</span><br><span class="line">AddType application/x-gzip .gz .tgz .parcel</span><br><span class="line"></span><br><span class="line">#Downloading and Publishing the Package Repository</span><br><span class="line"></span><br><span class="line">#Cloudera Manager 6</span><br><span class="line">sudo mkdir -p /var/www/html/cloudera-repos</span><br><span class="line">sudo wget --recursive --no-parent --no-host-directories https://archive.cloudera.com/cm6/6.0.0/redhat7/ -P /var/www/html/cloudera-repos</span><br><span class="line">sudo chmod -R ugo+rX /var/www/html/cloudera-repos/cm6</span><br><span class="line"></span><br><span class="line">#CDH 6</span><br><span class="line">sudo mkdir -p /var/www/html/cloudera-repos</span><br><span class="line">sudo wget --recursive --no-parent --no-host-directories https://archive.cloudera.com/cdh6/6.0.0/redhat7/ -P /var/www/html/cloudera-repos</span><br><span class="line"></span><br><span class="line">sudo wget --recursive --no-parent --no-host-directories https://archive.cloudera.com/gplextras6/6.0.0/redhat7/ -P /var/www/html/cloudera-repos</span><br><span class="line"></span><br><span class="line">sudo chmod -R ugo+rX /var/www/html/cloudera-repos/cdh6</span><br><span class="line">sudo chmod -R ugo+rX /var/www/html/cloudera-repos/gplextras6</span><br></pre></td></tr></table></figure>
</li>
<li><p>Creating a Temporary Internal Repository(Option)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Download the repository you need following the instructions in Downloading and Publishing the Package Repository.</span><br><span class="line">cd /var/www/html</span><br><span class="line">python -m SimpleHTTPServer 8900</span><br><span class="line"></span><br><span class="line">#Visit the Repository URL http://&lt;web_server&gt;:8900/cloudera-repos/</span><br></pre></td></tr></table></figure>
</li>
<li><p>Configuring Hosts to Use the Internal Repository</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Create /etc/yum.repos.d/cloudera-repo.repo files on cluster hosts with the following content, </span><br><span class="line">where &lt;web_server&gt; is the hostname of the web server:</span><br><span class="line"></span><br><span class="line">[cloudera-repo]</span><br><span class="line">name=cloudera-repo</span><br><span class="line">baseurl=http://&lt;web_server&gt;/cm/5</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a><b>遇到的问题</b></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># jdbc驱动未找到</span><br><span class="line">mkdir -p /usr/share/java</span><br><span class="line">rz mysql-connector-java-5.1.45-bin.jar</span><br><span class="line">ln -s mysql-connector-java-5.1.45-bin.jar mysql-connector-java.jar</span><br><span class="line">systemctl restart cloudera-scm-server.service</span><br><span class="line"></span><br><span class="line"># host命令为找到</span><br><span class="line">yum install bind-utils -y</span><br></pre></td></tr></table></figure>
<p>ref<br><a href="https://gist.github.com/lilongen/b179b3868d2c2839ca7303b7605ce16b" target="_blank" rel="noopener">deploy-cm-cdh-on-centos7</a><br><a href="https://www.cloudera.com/documentation/enterprise/6/6.0/topics/cm_ig_create_local_package_repo.html#download_publish_package_repo" target="_blank" rel="noopener">Custom Installation Solutions</a><br><a href="https://www.cloudera.com/documentation/enterprise/6/latest/topics/cm_ig_create_local_parcel_repo.html#" target="_blank" rel="noopener">Using an Internally Hosted Remote Parcel Repository</a></p>
<hr>
<p>您的鼓励是我写作最大的动力</p>
<p>俗话说，投资效率是最好的投资。 如果您感觉我的文章质量不错，读后收获很大，预计能为您提高 10% 的工作效率，不妨小额捐助我一下，让我有动力继续写出更多好文章。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h5 id=&quot;Cloudera-简介&quot;&gt;&lt;a href=&quot;#Cloudera-简介&quot; class=&quot;headerlink&quot; title=&quot;Cloudera 简介&quot;&gt;&lt;/a&gt;&lt;b&gt;Cloudera 简介&lt;/b&gt;&lt;/h5&gt;&lt;ul&gt;
&lt;li&gt;Cloudera 官网：&lt;a href=&quot;
    
    </summary>
    
    
  </entry>
  
</feed>
